scale_y_continuous(expand = c(0,0,0,5))+
labs(x = "Distance", y = "Count")+
theme(
text = element_text(family="serif"),
panel.grid = element_blank(),
panel.background = element_blank(),
axis.text = element_text(size = 14,colour = "black"),
axis.title = element_text(size = 18,colour = "black",
vjust = -2, hjust = 0.5)
)
M.data %>%
filter(analysis %in% "Y") %>%
group_by(Office, Survey, Year) %>%
summarise(E = sum(Macaca_sur)/n()) %>%
ggplot(., aes(x = Office, y = E)) +
geom_boxplot(size = 1, width = 0.4, fill= gray(.9))+
scale_y_continuous(breaks = seq(0,0.15,0.05), limits = c(0,0.15))+
labs(x = "林管處", y = "Encounter_rate")+
theme(
text = element_text(family="serif"),
panel.border = element_rect(size = 1.5,fill = NA),
panel.grid = element_blank(),
panel.background = element_blank(),
axis.text = element_text(size = 14,colour = "black"),
axis.title = element_text(size = 18,colour = "black",
vjust = -2, hjust = 0.5)
)
M.data %>%
filter(analysis %in% "Y") %>%
group_by(TypeName.1, Survey, Year) %>%
summarise(E = sum(Macaca_sur)/n()) %>%
ggplot(., aes(x = TypeName.1, y = E)) +
geom_boxplot(size = 1, width = 0.4, fill= gray(.9))+
scale_y_continuous(breaks = seq(0,0.15,0.05),
limits = c(0,0.15))+
labs(x = "森林類型", y = "Encounter_rate")+
theme(
text = element_text(family="serif"),
panel.border = element_rect(size = 1.5,fill = NA),
panel.grid = element_blank(),
panel.background = element_blank(),
axis.text = element_text(size = 14,colour = "black"),
axis.title = element_text(size = 18,colour = "black",
vjust = -2, hjust = 0.5)
)
M.data %>%
filter(analysis %in% "Y") %>%
group_by(TypeName.1, Survey, Year) %>%
summarise(E = sum(Macaca_sur)/n()) %>%
ggplot(., aes(x = TypeName.1, y = E)) +
geom_boxplot(size = 1, width = 0.4, fill= gray(.9))+
#  scale_y_continuous(breaks = seq(0,0.15,0.05),
#                     limits = c(0,0.15))+
labs(x = "森林類型", y = "Encounter_rate")+
theme(
text = element_text(family="serif"),
panel.border = element_rect(size = 1.5,fill = NA),
panel.grid = element_blank(),
panel.background = element_blank(),
axis.text = element_text(size = 14,colour = "black"),
axis.title = element_text(size = 18,colour = "black",
vjust = -2, hjust = 0.5)
)
Alt.d.n <-
M.data %>%
filter(analysis %in% "Y") %>%
mutate(Altitude_f =cut(Altitude,
breaks = c(seq(0,4000,500)),
labels = c(seq(250,3750,500)),
include.lowest = T) ) %>%
group_by(Altitude_f,Survey, Year) %>%
summarise(N = n(), E = sum(Macaca_sur)/n()) %>%
group_by(Altitude_f) %>%
summarise(mean_N = mean(N),
E25 = quantile(E,0.25),
E50 = quantile(E,0.50),
E75 = quantile(E,0.75)) %>%
ungroup()
M.data %>%
filter(analysis %in% "Y") %>%
mutate(Altitude_f =cut(Altitude,
breaks = c(seq(0,4000,500)),
labels = c(seq(250,3750,500)),
include.lowest = T) ) %>%
group_by(Altitude_f,Survey, Year) %>%
summarise(N = n(), E = sum(Macaca_sur)/n()) %>%
flextable(.) %>%
align(.,
align = "center", part = "all")
M.data %>%
filter(analysis %in% "Y") %>%
mutate(Altitude_f =cut(Altitude,
breaks = c(seq(0,4000,500)),
labels = c(seq(250,3750,500)),
include.lowest = T) ) %>%
group_by(Altitude_f,Survey, Year) %>%
summarise(E = sum(Macaca_sur)/n()) %>%
ungroup()%>%
ggplot(., aes(x = Altitude_f, y = E)) +
geom_boxplot(size = 1, width = 0.4, fill= gray(.9))+
geom_text(data = Alt.d.n,
aes(y = E75,
label = mean_N),
size = 4,
hjust = -0.2,
vjust = -0.7,
position = position_dodge(0.9))+
scale_y_continuous(breaks = seq(0,1,0.2)#,
#    limits = c(0,0.10)
)+ #0.10
labs(x = "Elevation (m)",
y = "Encounter rate (troop/point)") +
theme(
text = element_text(family="serif"),
panel.border = element_rect(size = 1.5,fill = NA),
panel.grid = element_blank(),
panel.background = element_blank(),
axis.text = element_text(size = 14,colour = "black"),
axis.title = element_text(size = 18,colour = "black",
vjust = -2, hjust = 0.5)
)
M.data %>%
filter(analysis %in% "Y") %>%
mutate(Altitude_f =cut(Altitude,
breaks = c(seq(0,4000,500)),
labels = c(seq(250,3750,500)),
include.lowest = T) ) %>%
group_by(Altitude_f,Survey, Year) %>%
summarise(E = sum(Macaca_sur)/n()) %>%
ungroup()%>%
ggplot(., aes(x = Altitude_f, y = E)) +
geom_boxplot(size = 1, width = 0.4, fill= gray(.9))+
geom_text(data = Alt.d.n,
aes(y = E75,
label = mean_N),
size = 4,
hjust = -0.2,
vjust = -0.7,
position = position_dodge(0.9))+
scale_y_continuous(breaks = seq(0,0.10,0.02),
limits = c(0,0.10)
)+
coord_cartesian(xlim = c(1, 6))+
labs(x = "Elevation (m)",
y = "Encounter rate (troop/point)") +
theme(
text = element_text(family="serif"),
panel.border = element_rect(size = 1.5,fill = NA),
panel.grid = element_blank(),
panel.background = element_blank(),
axis.text = element_text(size = 14,colour = "black"),
axis.title = element_text(size = 18,colour = "black",
vjust = -2, hjust = 0.5)
)
M.data %>%
filter(analysis %in% "Y") %>%
mutate(Altitude_f =cut(Altitude,
breaks = c(seq(0,4000,500)),
labels = c(seq(250,3750,500)),
include.lowest = T) ) %>%
group_by(Altitude_f,Survey, Year) %>%
summarise(E = sum(Macaca_sur)/n()) %>%
group_by(Altitude_f) %>% #確認中位數
summarise(mid = median(E))
M.data %>%
filter(analysis %in% "Y") %>%
filter(Macaca_sur %in% 1) %>%
.$Altitude %>%
hist(breaks = c(seq(0,3200,100)))
M.data %>%
filter(analysis %in% "Y") %>%
mutate(Altitude_f =cut(Altitude,
breaks = c(seq(0,4000,100)),
labels = c(seq(50,4000,100)),
include.lowest =T) ) %>%
group_by(Altitude_f, Year) %>%
summarise(N = n()) %>%
ggplot(., aes(x = Altitude_f, y = N))+
geom_point()
Group_than2
Group_than2 %>%
mutate(Year = as.character(Year)) %>%
reshape2::melt(id = c(1,3)) %>%
arrange(Site_N) %>%
flextable(.) %>%
width(., width = c(1,1,2,1)) %>%
align(.,j = 1:4,
align = "center", part = "all")  %>%
set_header_labels(
'Site_N' = "樣區編號",
'N' = "猴群數" )
Group_than2<- M.data %>%
filter(analysis %in% "Y") %>%
filter(Macaca_sur %in% 1) %>%
group_by(Year, Survey, Site_N) %>%
summarise(N = n()) %>%
filter(N>1)
Group_than2 %>%
mutate(Year = as.character(Year)) %>%
reshape2::melt(id = c(1,3)) %>%
reshape2::dcast(Year+樣區編號 ~ variable,
guess.value = "value") %>%
arrange(Site_N) %>%
flextable(.) %>%
width(., width = c(1,1,2,1)) %>%
align(.,j = 1:4,
align = "center", part = "all")  %>%
set_header_labels(
'Site_N' = "樣區編號",
'N' = "猴群數" )
Group_than2<- M.data %>%
filter(analysis %in% "Y") %>%
filter(Macaca_sur %in% 1) %>%
group_by(Year, Survey, Site_N) %>%
summarise(N = n()) %>%
filter(N>1)
Group_than2 %>%
mutate(Year = as.character(Year)) %>%
reshape2::melt(id = c(1,3)) %>%
reshape2::dcast(Year+Site_N ~ variable,
guess.value = "value") %>%
arrange(Site_N) %>%
flextable(.) %>%
width(., width = c(1,1,2,1)) %>%
align(.,j = 1:4,
align = "center", part = "all")  %>%
set_header_labels(
'Site_N' = "樣區編號",
'N' = "猴群數" )
Group_than2<- M.data %>%
filter(analysis %in% "Y") %>%
filter(Macaca_sur %in% 1) %>%
group_by(Year, Survey, Site_N) %>%
summarise(N = n()) %>%
filter(N>1)
Group_than2 %>%
mutate(Year = as.character(Year)) %>%
reshape2::melt(id = c(1,3)) %>%
reshape2::dcast(Year+Site_N ~ variable,
value.var = "value") %>%
arrange(Site_N) %>%
flextable(.) %>%
width(., width = c(1,1,2,1)) %>%
align(.,j = 1:4,
align = "center", part = "all")  %>%
set_header_labels(
'Site_N' = "樣區編號",
'N' = "猴群數" )
Group_than2<- M.data %>%
filter(analysis %in% "Y") %>%
filter(Macaca_sur %in% 1) %>%
group_by(Year, Survey, Site_N) %>%
summarise(N = n()) %>%
filter(N>1)
Group_than2 %>%
mutate(Year = as.character(Year)) %>%
reshape2::dcast(Year+Site_N ~ Survey,
value.var = "N") %>%
arrange(Site_N) %>%
flextable(.) %>%
width(., width = c(1,1,2,1)) %>%
align(.,j = 1:4,
align = "center", part = "all")  %>%
set_header_labels(
'Site_N' = "樣區編號",
'N' = "猴群數" )
Group_than2
Group_than2 %>%
left_join(M.data )
Group_than2 %>%
left_join(M.data )%>%
filter(analysis %in% "Y") %>%
filter(Macaca_sur %in% 1)
Group_than2 %>%
left_join(M.data, by = c("Site_N", "Year"))%>%
filter(analysis %in% "Y") %>%
filter(Macaca_sur %in% 1)
Group_than2 %>%
left_join(M.data, by = c("Site_N", "Year"))%>%
filter(analysis %in% "Y") %>%
filter(Macaca_sur %in% 1) %>%
group_by(Year, Survey.x, Site_N) %>%
summarise(N = n())
Group_than2<- M.data %>%
filter(analysis %in% "Y") %>%
filter(Macaca_sur %in% 1) %>%
group_by(Year, Survey, Site_N) %>%
summarise(N = n()) %>%
filter(N>1)
Group_than2 %>%
mutate(Year = as.character(Year)) %>%
reshape2::dcast(Year+Site_N ~ Survey,
value.var = "N") %>%
arrange(Site_N) %>%
flextable(.) %>%
width(., width = c(1,1,2,1)) %>%
align(.,j = 1:4,
align = "center", part = "all")  %>%
set_header_labels(
'Site_N' = "樣區編號",
'N' = "猴群數" )
M.data %>%
summarise(
'1 收到' = n(),
'2-1 6min' = str_subset(analysis, "6min") %>% length,
'2-2 Toolate' = str_subset(analysis, "Toolate") %>% length,
'2-3 7day' = str_subset(analysis, "7day") %>% length,
'2-4 locate' = str_subset(analysis, "locate") %>% length,
'end of 2' = str_subset(analysis, "locate|6min|Toolate|7day", negate = T) %>% length,
'3 不在3~6月內' = str_subset(analysis, "month") %>% length,
'4 低於50m' = str_subset(analysis, "50m") %>% length,
'5 非森林' = str_subset(analysis, "NotForest") %>% length,
'6 分析用' = str_subset(analysis, "^Y$") %>% length
) %>%
reshape2::melt(variable.name = "項目",
value.name = "樣點次")
M.data %>% filter(is.na(Macaca_sur)) %>% dim
M.data %>% filter(!is.na(Macaca_sur)) %>% dim
View(M.data)
#樣點資料檢核
#---- load library
library(tidyverse)
library(readxl)
library(writexl)
DF<-
lapply(paste0("./data/raw/FORESTRYdata/", 2020:2021), function(x){
list.files(x, full.names = T) %>%  #讀取各2020資料夾內的excel檔名
lapply(., function(x){
x %>%
excel_sheets(.) %>%   #讀取各excel內的sheet名
lapply(.,read_excel, path = x,
col_names = T, col_type = "text", cell_cols("B:S")) %>%  #讀取各sheet的內容
bind_rows()
})
}) %>%
bind_rows() %>%
select(Office = `林管處`,
Station = `工作站`,
Site_N = `樣區編號`,
Year = `年`,
Month = `月`,
Day = `日`,
Survey = `旅次`,
Surveyor = `調查者`,
Point = `樣點編號`,
TWD97_X = `X座標(TWD97)`,
TWD97_Y = `Y座標(TWD97)`,
Hour = `時`,
Minute = `分`,
Macaca_sur = `數量`,
Macaca_dist = `距離`,
Macaca_voice = `叫聲`,
Habitat = `棲地類型(主要)`) %>%
mutate(Surveyor = gsub(",","、", Surveyor)) %>%
mutate(Surveyor = gsub(" ","", Surveyor)) %>%
mutate(Macaca_voice = gsub("n","N", .$Macaca_voice)) %>%
mutate(Macaca_voice = ifelse(Macaca_sur %in% 0 & Macaca_voice %in% c("N"), NA,  Macaca_voice)) %>%
mutate(Date = ISOdatetime(Year, Month, Day, Hour, Minute, sec = 0) ) %>%
mutate(Office = ordered(Office, c("羅東", "新竹", "東勢", "南投", "嘉義", "屏東", "花蓮", "臺東")))
#調查者的統計資料
List_surveyor <-
DF %>%
separate(.,Surveyor,
into = paste0("Surveyor","_",0:10),
sep ="、|,", extra = "drop", fill = "right") %>%
reshape2::melt(., id.vars = c("Office","Year", "Site_N", "Point",  "Survey"),
measure.vars = paste0("Surveyor","_",0:10),
variable.name = "Surveyor", value.name = "Name",)%>%
filter(!is.na(Name))
List_surveyor %>%
mutate(SP = paste0(Site_N, "-", Point)) %>%
group_by(Year, Office) %>%
summarise(Site_n = Site_N %>% unique %>% length,     #樣區數
Person_n = Name %>% unique %>% length) %>%  #人數
arrange(Office)
#調查者的統計資料
List_surveyor <-
M.data %>%
separate(.,Surveyor,
into = paste0("Surveyor","_",0:10),
sep ="、|,", extra = "drop", fill = "right") %>%
reshape2::melt(., id.vars = c("Office","Year", "Site_N", "Point",  "Survey"),
measure.vars = paste0("Surveyor","_",0:10),
variable.name = "Surveyor", value.name = "Name",)%>%
filter(!is.na(Name))
List_surveyor %>%
mutate(SP = paste0(Site_N, "-", Point)) %>%
group_by(Year, Office) %>%
summarise(Site_n = Site_N %>% unique %>% length,     #樣區數
Person_n = Name %>% unique %>% length) %>%  #人數
arrange(Office)
M.data %>%
filter(! is.na(Macaca_sur))
M.data %>%
filter(! is.na(Macaca_sur)) %>%
group_by(Office, Survey) %>%
summarise(
Point_n = n(),
Good_n = str_subset(analysis, "^Y") %>% n()
)
M.data %>%
filter(! is.na(Macaca_sur))
M.data %>%
filter(! is.na(Macaca_sur)) %>%
group_by(Office, Survey) %>%
summarise(
Point_n = n(),
Good_n = str_subset(analysis, "^Y") %>%length
)
rep(c("Point_n", "Good_n", "prob"),2)
M.data %>%
filter(! is.na(Macaca_sur)) %>%
group_by(Office, Survey) %>%
summarise(
Point_n = n(),
Good_n = str_subset(analysis, "^Y") %>%length
) %>%
bind_rows(
M.data %>%
filter(! is.na(Macaca_sur))%>%
group_by(Survey) %>%
summarise(
Point_n = n(),
Good_n = str_subset(analysis, "^Y") %>%length
) %>%
mutate(Office = "Total")
) %>%
mutate(prob = (100 * Good_n/Point_n) %>%  round(1)) %>%
reshape2::melt(id = 1:2) %>%
reshape2::dcast(Office ~ Survey+variable) %>%
flextable(.) %>%
set_header_labels(
"1_Point_n"="樣點",
"1_Good_n" = "無疏失的樣點",
"1_prob" = "正確率%",
"2_Point_n"="樣點",
"2_Good_n" = "無疏失的樣點",
"2_prob" = "正確率%") %>%
add_header_row(.,
values = c(" ","第1旅次", "第2旅次"),
colwidths = c(1,3,3)) %>%
hline_top(., j = 1)%>%
align(.,
align = "center", part = "header")
M.data %>%
filter(! is.na(Macaca_sur)) %>%
group_by(Office, Survey) %>%
summarise(
Point_n = n(),
Good_n = str_subset(analysis, "^Y") %>%length
) %>%
bind_rows(
M.data %>%
filter(! is.na(Macaca_sur))%>%
group_by(Survey) %>%
summarise(
Point_n = n(),
Good_n = str_subset(analysis, "^Y") %>%length
) %>%
mutate(Office = "Total")
) %>%
mutate(prob = (100 * Good_n/Point_n) %>%  round(1)) %>%
reshape2::melt(id = 1:2) %>%
reshape2::dcast(Office ~ Survey+variable) %>%
flextable(.) %>%
set_header_labels(
"1_Point_n"="樣點",
"1_Good_n" = "無疏失的樣點",
"1_prob" = "正確率%",
"2_Point_n"="樣點",
"2_Good_n" = "無疏失的樣點",
"2_prob" = "正確率%") %>%
add_header_row(.,
values = c(" ","第1旅次", "第2旅次"),
colwidths = c(1,3,3)) %>%
hline_top(., j = 0)%>%
align(.,
align = "center", part = "header")
M.data %>%
filter(! is.na(Macaca_sur)) %>%
group_by(Office, Survey) %>%
summarise(
Point_n = n(),
Good_n = str_subset(analysis, "^Y") %>%length
) %>%
bind_rows(
M.data %>%
filter(! is.na(Macaca_sur))%>%
group_by(Survey) %>%
summarise(
Point_n = n(),
Good_n = str_subset(analysis, "^Y") %>%length
) %>%
mutate(Office = "Total")
) %>%
mutate(prob = (100 * Good_n/Point_n) %>%  round(1)) %>%
reshape2::melt(id = 1:2) %>%
reshape2::dcast(Office ~ Survey+variable) %>%
flextable(.) %>%
set_header_labels(
"1_Point_n"="樣點",
"1_Good_n" = "無疏失的樣點",
"1_prob" = "正確率%",
"2_Point_n"="樣點",
"2_Good_n" = "無疏失的樣點",
"2_prob" = "正確率%") %>%
add_header_row(.,
values = c(" ","第1旅次", "第2旅次"),
colwidths = c(1,3,3)) %>%
hline_top(., j = 1)%>%
align(.,
align = "center", part = "header")
