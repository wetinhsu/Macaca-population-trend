mutate(Surveyor = gsub(",","、", Surveyor)) %>%
mutate(Surveyor = gsub(" ","", Surveyor)) %>%
mutate(Macaca_voice = gsub("n","N", .$Macaca_voice)) %>%
mutate(Macaca_voice = ifelse(Macaca_sur %in% 0 & Macaca_voice %in% c("N"), NA,  Macaca_voice)) %>%
mutate(Date = ISOdatetime(Year, Month, Day, Hour, Minute, sec = 0) ) %>%
mutate(Office = ordered(Office, c("羅東", "新竹", "東勢", "南投", "嘉義", "屏東", "花蓮", "臺東")))
DF %>%
filter(Macaca_sur %in% 0) %>%
filter(! is.na(Macaca_dist) | !is.na(Macaca_voice) )
DF %>%
filter( Macaca_sur %in% c(1, 2)) %>%
filter( is.na(Macaca_dist) | is.na(Macaca_voice) )
#確認旅次---
DF <-
DF %>%
reshape2::dcast(Year + Site_N ~ Survey, length, value.var = "Macaca_sur") %>%
#計算第1旅次及第2旅次調查的樣點數
filter(`1` %in% 0 & `2` >= 6) %>%  #找出有第2旅次沒第1旅次的樣區
left_join(DF, ., by = c("Year", "Site_N"))%>%
mutate( Survey = ifelse(!is.na(`1`),1, Survey)) %>%#將第1次調查的旅次改回1
select(-`1`, -`2`, -`NA`)
Count_Point_Survey <-
DF %>%
filter(!is.na(Macaca_sur) ) %>%
group_by(Office, Survey) %>%
summarise(Site_n = Site_N %>% unique %>% length,
Data_n = n()) %>%
reshape2::melt(id = 1:2) %>%
reshape2::dcast(Office ~ Survey + variable, guess_var = "value")
DF.2 <-
DF %>%
add_column(analysis = "Y", .before = "Office") %>%
mutate(SS = paste0(Site_N, "-", Survey)) %>%
split(.,.$SS) %>%
lapply(., function(x){  #計算調查時間間隔
x[order(x$Date),] %>%
mutate(time2 = NA) %>%
mutate(time2 = c(Date[2: length(Date)], NA)) %>%
mutate(time.diff = difftime(time2, Date, units ="mins")%>% as.numeric()) %>% #時間相隔，以分為單位
mutate(day.diff = difftime(time2, Date, units ="day"))  #時間相隔，以日為單位
}) %>%
lapply(., function(x){  #計算位置誤差距離：依樣區旅次分別計算各樣區內，各樣點離做近檢核點的距離
st_M.Point <-  #與st_DF對應的樣區
st_M.Point %>%
filter(Macaca_Site %in% unique(x$Site_N))
st_DF.2 <-
x %>%
mutate(SP = ifelse(!nchar(Point) %in% 1,
paste0(Site_N, "-0", Point),
paste0(Site_N, "-", Point))) %>%
mutate(X = as.numeric(TWD97_X)) %>%
mutate(Y = as.numeric(TWD97_Y)) %>%
st_as_sf(., coords = c("X", "Y"), crs = 3826)
st_DF.2$point_O <-
st_distance(st_DF.2, st_M.Point) %>%
apply(.,1,which.min) %>%
st_M.Point$樣區樣點編號[.]
st_DF.2$point.diff <-
st_distance(st_DF.2, st_M.Point) %>%
apply(., 1,min)
return(st_drop_geometry(st_DF.2))}) %>%
lapply(., function(x){     # 超過7日才完成調查，整個旅次的資料方棄
if(TRUE %in% (as.numeric(x$day.diff)>8)) x$analysis <- "N"
return(x)
})%>%
bind_rows() %>%
select(-SS)
View(DF.2)
View(DF)
DF.2 <-
DF %>%
add_column(analysis = "Y", .before = "Office") %>%
mutate(SS = paste0(Site_N, "-", Survey)) %>%
split(.,.$SS) %>%
lapply(., function(x){  #計算調查時間間隔
#     x[order(x$Date),] %>%
#       mutate(time2 = NA) %>%
#       mutate(time2 = c(Date[2: length(Date)], NA)) %>%
#      mutate(time.diff = difftime(time2, Date, units ="mins")%>% as.numeric()) %>% #時間相隔，以分為單位
#      mutate(day.diff = difftime(time2, Date, units ="day"))  #時間相隔，以日為單位
x %>%
arrange(Date) %>%
mutate(time_2=  c(Date[2: n()], NA))%>%
mutate(time_diff = difftime(time_2, Date, units='mins') %>%
as.numeric())  %>%
select(-time_2) %>%
mutate(day_diff = difftime(Date[n()], Date[1], units='days') %>%
as.numeric() %>% round(.,0))
}) %>%
lapply(., function(x){  #計算位置誤差距離：依樣區旅次分別計算各樣區內，各樣點離做近檢核點的距離
st_M.Point <-  #與st_DF對應的樣區
st_M.Point %>%
filter(Macaca_Site %in% unique(x$Site_N))
st_DF.2 <-
x %>%
mutate(SP = ifelse(!nchar(Point) %in% 1,
paste0(Site_N, "-0", Point),
paste0(Site_N, "-", Point))) %>%
mutate(X = as.numeric(TWD97_X)) %>%
mutate(Y = as.numeric(TWD97_Y)) %>%
st_as_sf(., coords = c("X", "Y"), crs = 3826)
st_DF.2$point_O <-
st_distance(st_DF.2, st_M.Point) %>%
apply(.,1,which.min) %>%
st_M.Point$樣區樣點編號[.]
st_DF.2$point.diff <-
st_distance(st_DF.2, st_M.Point) %>%
apply(., 1,min)
return(st_drop_geometry(st_DF.2))}) %>%
lapply(., function(x){     # 超過7日才完成調查，整個旅次的資料方棄
if(TRUE %in% (as.numeric(x$day.diff)>8)) x$analysis <- "N"
return(x)
})%>%
bind_rows() %>%
select(-SS)
DF.2%>%   #刪除輔註欄位
mutate(analysis =case_when(analysis %in% "Y" & as.numeric(Hour) >= 11            ~ "N1",  #11點
analysis %in% "Y" & time.diff < 6 & !is.na(time.diff) ~ "N2",  #6分鐘
analysis %in% "Y" & point.diff > 50                   ~ "N3",  # range of gps =50m
analysis %in% "Y" & Point %in% "X"                    ~ "N3",  # range of gps =50m
TRUE ~ analysis)) %>%
View
DF.2%>%   #刪除輔註欄位
mutate(analysis =case_when(analysis %in% "Y" & as.numeric(Hour) >= 11            ~ "N1",  #11點
analysis %in% "Y" & time_diff < 6 & !is.na(time.diff) ~ "N2",  #6分鐘
analysis %in% "Y" & point_diff > 50                   ~ "N3",  # range of gps =50m
analysis %in% "Y" & Point %in% "X"                    ~ "N3",  # range of gps =50m
TRUE ~ analysis)) %>%
View
DF.2%>%   #刪除輔註欄位
mutate(analysis =case_when(analysis %in% "Y" & as.numeric(Hour) >= 11            ~ "N1",  #11點
analysis %in% "Y" & time_diff < 6 & !is.na(time_diff) ~ "N2",  #6分鐘
analysis %in% "Y" & point_diff > 50                   ~ "N3",  # range of gps =50m
analysis %in% "Y" & Point %in% "X"                    ~ "N3",  # range of gps =50m
TRUE ~ analysis)) %>%
View
DF.2%>%   #刪除輔註欄位
mutate(analysis =case_when(analysis %in% "Y" & as.numeric(Hour) >= 11            ~ "N1",  #11點
analysis %in% "Y" & time_diff < 6 & !is.na(time_diff) ~ "N2",  #6分鐘
analysis %in% "Y" & point.diff > 50                   ~ "N3",  # range of gps =50m
analysis %in% "Y" & Point %in% "X"                    ~ "N3",  # range of gps =50m
TRUE ~ analysis)) %>%
View
DF.2 <-
DF %>%
add_column(analysis = "Y", .before = "Office") %>%
mutate(SS = paste0(Site_N, "-", Survey)) %>%
split(.,.$SS) %>%
lapply(., function(x){  #計算調查時間間隔
#     x[order(x$Date),] %>%
#       mutate(time2 = NA) %>%
#       mutate(time2 = c(Date[2: length(Date)], NA)) %>%
#      mutate(time.diff = difftime(time2, Date, units ="mins")%>% as.numeric()) %>% #時間相隔，以分為單位
#      mutate(day.diff = difftime(time2, Date, units ="day"))  #時間相隔，以日為單位
x %>%
arrange(Date) %>%
mutate(time_2=  c(Date[2: n()], NA))%>%
mutate(time_diff = difftime(time_2, Date, units='mins') %>%
as.numeric())  %>%
mutate(analysis = ifelse(time_diff<6, ", 6min", analysis)) %>%
select(-time_2) %>%
mutate(day_diff = difftime(Date[n()], Date[1], units='days') %>%
as.numeric() %>% round(.,0))  %>%
#       mutate(analysis = ifelse(day_diff > 7,
#                          paste0(analysis, ", 7day"), analysis)) %>%
mutate(analysis = ifelse(Hour >= 11,
paste0(analysis, ", Toolate"), analysis))
}) %>%
lapply(., function(x){  #計算位置誤差距離：依樣區旅次分別計算各樣區內，各樣點離做近檢核點的距離
st_M.Point <-  #與st_DF對應的樣區
st_M.Point %>%
filter(Macaca_Site %in% unique(x$Site_N))
st_DF.2 <-
x %>%
mutate(SP = ifelse(!nchar(Point) %in% 1,
paste0(Site_N, "-0", Point),
paste0(Site_N, "-", Point))) %>%
mutate(X = as.numeric(TWD97_X)) %>%
mutate(Y = as.numeric(TWD97_Y)) %>%
st_as_sf(., coords = c("X", "Y"), crs = 3826)
st_DF.2$point_O <-
st_distance(st_DF.2, st_M.Point) %>%
apply(.,1,which.min) %>%
st_M.Point$樣區樣點編號[.]
st_DF.2$point.diff <-
st_distance(st_DF.2, st_M.Point) %>%
apply(., 1,min)
return(st_drop_geometry(st_DF.2))}) %>%
lapply(., function(x){     # 超過7日才完成調查，整個旅次的資料方棄
if(TRUE %in% (as.numeric(x$day.diff)>8)) x$analysis <- "N"
return(x)
})%>%
bind_rows() %>%
select(-SS)
DF.2 <-
DF %>%
add_column(analysis = "Y", .before = "Office") %>%
mutate(SS = paste0(Site_N, "-", Survey)) %>%
split(.,.$SS) %>%
lapply(., function(x){  #計算調查時間間隔
#     x[order(x$Date),] %>%
#       mutate(time2 = NA) %>%
#       mutate(time2 = c(Date[2: length(Date)], NA)) %>%
#      mutate(time.diff = difftime(time2, Date, units ="mins")%>% as.numeric()) %>% #時間相隔，以分為單位
#      mutate(day.diff = difftime(time2, Date, units ="day"))  #時間相隔，以日為單位
x %>%
arrange(Date) %>%
mutate(time_2=  c(Date[2: n()], NA))%>%
mutate(time_diff = difftime(time_2, Date, units='mins') %>%
as.numeric())  %>%
mutate(analysis = ifelse(time_diff<6,  paste0(analysis, ", 6min"), analysis)) %>%
select(-time_2) %>%
mutate(day_diff = difftime(Date[n()], Date[1], units='days') %>%
as.numeric() %>% round(.,0))  %>%
#       mutate(analysis = ifelse(day_diff > 7,
#                          paste0(analysis, ", 7day"), analysis)) %>%
mutate(analysis = ifelse(Hour >= 11,
paste0(analysis, ", Toolate"), analysis))
}) %>%
lapply(., function(x){  #計算位置誤差距離：依樣區旅次分別計算各樣區內，各樣點離做近檢核點的距離
st_M.Point <-  #與st_DF對應的樣區
st_M.Point %>%
filter(Macaca_Site %in% unique(x$Site_N))
st_DF.2 <-
x %>%
mutate(SP = ifelse(!nchar(Point) %in% 1,
paste0(Site_N, "-0", Point),
paste0(Site_N, "-", Point))) %>%
mutate(X = as.numeric(TWD97_X)) %>%
mutate(Y = as.numeric(TWD97_Y)) %>%
st_as_sf(., coords = c("X", "Y"), crs = 3826)
st_DF.2$point_O <-
st_distance(st_DF.2, st_M.Point) %>%
apply(.,1,which.min) %>%
st_M.Point$樣區樣點編號[.]
st_DF.2$point.diff <-
st_distance(st_DF.2, st_M.Point) %>%
apply(., 1,min)
return(st_drop_geometry(st_DF.2))}) %>%
lapply(., function(x){     # 超過7日才完成調查，整個旅次的資料方棄
if(TRUE %in% (as.numeric(x$day.diff)>8)) x$analysis <- "N"
return(x)
})%>%
bind_rows() %>%
select(-SS)
DF.2 <-
DF %>%
add_column(analysis = "Y", .before = "Office") %>%
mutate(SS = paste0(Site_N, "-", Survey)) %>%
split(.,.$SS) %>%
lapply(., function(x){  #計算調查時間間隔
#     x[order(x$Date),] %>%
#       mutate(time2 = NA) %>%
#       mutate(time2 = c(Date[2: length(Date)], NA)) %>%
#      mutate(time.diff = difftime(time2, Date, units ="mins")%>% as.numeric()) %>% #時間相隔，以分為單位
#      mutate(day.diff = difftime(time2, Date, units ="day"))  #時間相隔，以日為單位
x %>%
arrange(Date) %>%
mutate(time_2=  c(Date[2: n()], NA))%>%
mutate(time_diff = difftime(time_2, Date, units='mins') %>%
as.numeric())  %>%
mutate(analysis = ifelse(time_diff<6,  paste0(analysis, ", 6min"), analysis)) %>%
select(-time_2) %>%
mutate(day_diff = difftime(Date[n()], Date[1], units='days') %>%
as.numeric() %>% round(.,0))  %>%
#       mutate(analysis = ifelse(day_diff > 7,
#                          paste0(analysis, ", 7day"), analysis)) %>%
mutate(analysis = ifelse(as.numeric(Hour) >= 11,
paste0(analysis, ", Toolate"), analysis))
}) %>%
lapply(., function(x){  #計算位置誤差距離：依樣區旅次分別計算各樣區內，各樣點離做近檢核點的距離
st_M.Point <-  #與st_DF對應的樣區
st_M.Point %>%
filter(Macaca_Site %in% unique(x$Site_N))
st_DF.2 <-
x %>%
mutate(SP = ifelse(!nchar(Point) %in% 1,
paste0(Site_N, "-0", Point),
paste0(Site_N, "-", Point))) %>%
mutate(X = as.numeric(TWD97_X)) %>%
mutate(Y = as.numeric(TWD97_Y)) %>%
st_as_sf(., coords = c("X", "Y"), crs = 3826)
st_DF.2$point_O <-
st_distance(st_DF.2, st_M.Point) %>%
apply(.,1,which.min) %>%
st_M.Point$樣區樣點編號[.]
st_DF.2$point.diff <-
st_distance(st_DF.2, st_M.Point) %>%
apply(., 1,min)
return(st_drop_geometry(st_DF.2))}) %>%
lapply(., function(x){     # 超過7日才完成調查，整個旅次的資料方棄
if(TRUE %in% (as.numeric(x$day.diff)>8)) x$analysis <- "N"
return(x)
})%>%
bind_rows() %>%
select(-SS)
DF.2 <-
DF %>%
add_column(analysis = "Y", .before = "Office") %>%
mutate(SS = paste0(Site_N, "-", Survey)) %>%
split(.,.$SS) %>%
lapply(., function(x){  #計算調查時間間隔
#     x[order(x$Date),] %>%
#       mutate(time2 = NA) %>%
#       mutate(time2 = c(Date[2: length(Date)], NA)) %>%
#      mutate(time.diff = difftime(time2, Date, units ="mins")%>% as.numeric()) %>% #時間相隔，以分為單位
#      mutate(day.diff = difftime(time2, Date, units ="day"))  #時間相隔，以日為單位
x %>%
arrange(Date) %>%
mutate(time_2=  c(Date[2: n()], NA))%>%
mutate(time_diff = difftime(time_2, Date, units='mins') %>%
as.numeric())  %>%
mutate(analysis = ifelse(time_diff<6,  paste0(analysis, ", 6min"), analysis)) %>%
select(-time_2) %>%
mutate(day_diff = difftime(Date[n()], Date[1], units='days') %>%
as.numeric() %>% round(.,0))  %>%
#       mutate(analysis = ifelse(day_diff > 7,
#                          paste0(analysis, ", 7day"), analysis)) %>%
mutate(analysis = ifelse(as.numeric(Hour) >= 11,
paste0(analysis, ", Toolate"), analysis))
}) %>%
lapply(., function(x){  #計算位置誤差距離：依樣區旅次分別計算各樣區內，各樣點離做近檢核點的距離
st_M.Point <-  #與st_DF對應的樣區
st_M.Point %>%
filter(Macaca_Site %in% unique(x$Site_N))
st_DF.2 <-
x %>%
mutate(SP = ifelse(!nchar(Point) %in% 1,
paste0(Site_N, "-0", Point),
paste0(Site_N, "-", Point))) %>%
mutate(X = as.numeric(TWD97_X)) %>%
mutate(Y = as.numeric(TWD97_Y)) %>%
st_as_sf(., coords = c("X", "Y"), crs = 3826)
st_DF.2$point_O <-
st_distance(st_DF.2, st_M.Point) %>%
apply(.,1,which.min) %>%
st_M.Point$樣區樣點編號[.]
st_DF.2$point.diff <-
st_distance(st_DF.2, st_M.Point) %>%
apply(., 1,min)
return(st_drop_geometry(st_DF.2))}) %>%
lapply(., function(x){     # 超過7日才完成調查，整個旅次的資料方棄
if(TRUE %in% (as.numeric(x$day.diff)>8)) x$analysis <- "N"
return(x)
})%>%
bind_rows() %>%
select(-SS)
DF.2 <-
DF %>%
add_column(analysis = "Y", .before = "Office") %>%
mutate(SS = paste0(Site_N, "-", Survey)) %>%
split(.,.$SS) %>%
lapply(., function(x){  #計算調查時間間隔
#     x[order(x$Date),] %>%
#       mutate(time2 = NA) %>%
#       mutate(time2 = c(Date[2: length(Date)], NA)) %>%
#      mutate(time.diff = difftime(time2, Date, units ="mins")%>% as.numeric()) %>% #時間相隔，以分為單位
#      mutate(day.diff = difftime(time2, Date, units ="day"))  #時間相隔，以日為單位
x %>%
arrange(Date) %>%
mutate(time_2=  c(Date[2: n()], NA))%>%
mutate(time_diff = difftime(time_2, Date, units='mins') %>%
as.numeric())  %>%
mutate(analysis = ifelse(time_diff<6 & !is.na(time_diff),  paste0(analysis, ", 6min"), analysis)) %>%
select(-time_2) %>%
mutate(day_diff = difftime(Date[n()], Date[1], units='days') %>%
as.numeric() %>% round(.,0))  %>%
#       mutate(analysis = ifelse(day_diff > 7,
#                          paste0(analysis, ", 7day"), analysis)) %>%
mutate(analysis = ifelse(as.numeric(Hour) >= 11,
paste0(analysis, ", Toolate"), analysis))
}) %>%
lapply(., function(x){  #計算位置誤差距離：依樣區旅次分別計算各樣區內，各樣點離做近檢核點的距離
st_M.Point <-  #與st_DF對應的樣區
st_M.Point %>%
filter(Macaca_Site %in% unique(x$Site_N))
st_DF.2 <-
x %>%
mutate(SP = ifelse(!nchar(Point) %in% 1,
paste0(Site_N, "-0", Point),
paste0(Site_N, "-", Point))) %>%
mutate(X = as.numeric(TWD97_X)) %>%
mutate(Y = as.numeric(TWD97_Y)) %>%
st_as_sf(., coords = c("X", "Y"), crs = 3826)
st_DF.2$point_O <-
st_distance(st_DF.2, st_M.Point) %>%
apply(.,1,which.min) %>%
st_M.Point$樣區樣點編號[.]
st_DF.2$point.diff <-
st_distance(st_DF.2, st_M.Point) %>%
apply(., 1,min)
return(st_drop_geometry(st_DF.2))}) %>%
lapply(., function(x){     # 超過7日才完成調查，整個旅次的資料方棄
if(TRUE %in% (as.numeric(x$day.diff)>8)) x$analysis <- "N"
return(x)
})%>%
bind_rows() %>%
select(-SS)
DF.2 <-
DF %>%
add_column(analysis = "Y", .before = "Office") %>%
mutate(SS = paste0(Site_N, "-", Survey)) %>%
split(., .$Site_N) %>%
lapply(., function(x){  #檢核時間
x %>%
split(., .$Survey) %>%
lapply(., function(y){
#     x[order(x$Date),] %>%
#       mutate(time2 = NA) %>%
#       mutate(time2 = c(Date[2: length(Date)], NA)) %>%
#      mutate(time.diff = difftime(time2, Date, units ="mins")%>% as.numeric()) %>% #時間相隔，以分為單位
#      mutate(day.diff = difftime(time2, Date, units ="day"))  #時間相隔，以日為單位
y %>%
arrange(Date) %>%
mutate(time_2=  c(Date[2: n()], NA))%>%
mutate(time_diff = difftime(time_2, Date, units='mins') %>%
as.numeric())  %>%
mutate(analysis = ifelse(time_diff<6 & !is.na(time_diff),  paste0(analysis, ", 6min"), analysis)) %>%
select(-time_2) %>%
mutate(day_diff = difftime(Date[n()], Date[1], units='days') %>%
as.numeric() %>% round(.,0))  %>%
#       mutate(analysis = ifelse(day_diff > 7,
#                          paste0(analysis, ", 7day"), analysis)) %>%
mutate(analysis = ifelse(as.numeric(Hour) >= 11,
paste0(analysis, ", Toolate"), analysis))
}) %>%
bind_rows()}) %>%
bind_rows() %>%
split(., .$SS) %>%
lapply(., function(x){  #計算位置誤差距離：依樣區旅次分別計算各樣區內，各樣點離做近檢核點的距離
st_M.Point <-  #與st_DF對應的樣區
st_M.Point %>%
filter(Macaca_Site %in% unique(x$Site_N))
st_DF.2 <-
x %>%
mutate(SP = ifelse(!nchar(Point) %in% 1,
paste0(Site_N, "-0", Point),
paste0(Site_N, "-", Point))) %>%
mutate(X = as.numeric(TWD97_X)) %>%
mutate(Y = as.numeric(TWD97_Y)) %>%
st_as_sf(., coords = c("X", "Y"), crs = 3826)
st_DF.2$point_O <-
st_distance(st_DF.2, st_M.Point) %>%
apply(.,1,which.min) %>%
st_M.Point$樣區樣點編號[.]
st_DF.2$point.diff <-
st_distance(st_DF.2, st_M.Point) %>%
apply(., 1,min)
return(st_drop_geometry(st_DF.2))}) %>%
lapply(., function(x){     # 超過7日才完成調查，整個旅次的資料方棄
if(TRUE %in% (as.numeric(x$day.diff)>8)) x$analysis <- "N"
return(x)
})%>%
bind_rows() %>%
select(-SS)
DF.2 <-
DF %>%
add_column(analysis = "Y", .before = "Office") %>%
mutate(SS = paste0(Site_N, "-", Survey)) %>%
split(., .$Site_N) %>%
lapply(., function(x){  #檢核時間
x %>%
split(., .$Survey) %>%
lapply(., function(y){
#     x[order(x$Date),] %>%
#       mutate(time2 = NA) %>%
#       mutate(time2 = c(Date[2: length(Date)], NA)) %>%
#      mutate(time.diff = difftime(time2, Date, units ="mins")%>% as.numeric()) %>% #時間相隔，以分為單位
#      mutate(day.diff = difftime(time2, Date, units ="day"))  #時間相隔，以日為單位
y %>%
arrange(Date) %>%
mutate(time_2=  c(Date[2: n()], NA))%>%
mutate(time_diff = difftime(time_2, Date, units='mins') %>%
as.numeric())  %>%
mutate(analysis = ifelse(time_diff<6 & !is.na(time_diff),  paste0(analysis, ", 6min"), analysis)) %>%
select(-time_2) %>%
mutate(day_diff = difftime(Date[n()], Date[1], units='days') %>%
as.numeric() %>% round(.,0))  %>%
mutate(analysis = ifelse(day_diff > 7,
paste0(analysis, ", 7day"), analysis)) %>%
mutate(analysis = ifelse(as.numeric(Hour) >= 11,
paste0(analysis, ", Toolate"), analysis))
}) %>%
bind_rows()}) %>%
bind_rows() %>%
split(., .$SS) %>%
lapply(., function(x){  #計算位置誤差距離：依樣區旅次分別計算各樣區內，各樣點離做近檢核點的距離
st_M.Point <-  #與st_DF對應的樣區
st_M.Point %>%
filter(Macaca_Site %in% unique(x$Site_N))
st_DF.2 <-
x %>%
mutate(SP = ifelse(!nchar(Point) %in% 1,
paste0(Site_N, "-0", Point),
paste0(Site_N, "-", Point))) %>%
mutate(X = as.numeric(TWD97_X)) %>%
mutate(Y = as.numeric(TWD97_Y)) %>%
st_as_sf(., coords = c("X", "Y"), crs = 3826)
st_DF.2$point_O <-
st_distance(st_DF.2, st_M.Point) %>%
apply(.,1,which.min) %>%
st_M.Point$樣區樣點編號[.]
st_DF.2$point.diff <-
st_distance(st_DF.2, st_M.Point) %>%
apply(., 1,min)
return(st_drop_geometry(st_DF.2))}) %>%
#   lapply(., function(x){     # 超過7日才完成調查，整個旅次的資料方棄
#     if(TRUE %in% (as.numeric(x$day.diff)>8)) x$analysis <- "N"
#     return(x)
#  })%>%
bind_rows() %>%
select(-SS)
