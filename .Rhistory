suffix = c(".ori", "")) %>%
mutate(point_diff = NA) %>%
group_by(row.names(.)) %>%
mutate(ppp = ddd(TWD97_X.ori, TWD97_Y.ori, TWD97_X, TWD97_Y) ) %>%
View
DF %>%
add_column(analysis = "Y", .before = "Office") %>%
group_by( Site_N, Survey) %>%
arrange(Date, , .by_group = T) %>%
mutate(time_2=  c(Date[2: n()], NA))%>%
mutate(time_diff = difftime(time_2, Date, units='mins') %>%
as.numeric())  %>%
select(-time_2) %>%
mutate(day_diff = difftime(Date[n()], Date[1], units='days') %>%
as.numeric() %>% round(.,0)) %>%
ungroup() %>%
left_join(M.Point,
by = c("Site_N" = "Macaca_Site",
"Point" = "樣點代號"),
suffix = c(".ori", "")) %>%
st_as_sf(., coords = c("TWD97_X.ori", "TWD97_Y.ori"), crs = 3826,
remove = F,
na.fail = TRUE,
sf_column_name = "P.sur")%>%
View
DF %>%
add_column(analysis = "Y", .before = "Office") %>%
group_by( Site_N, Survey) %>%
arrange(Date, , .by_group = T) %>%
mutate(time_2=  c(Date[2: n()], NA))%>%
mutate(time_diff = difftime(time_2, Date, units='mins') %>%
as.numeric())  %>%
select(-time_2) %>%
mutate(day_diff = difftime(Date[n()], Date[1], units='days') %>%
as.numeric() %>% round(.,0)) %>%
ungroup() %>%
left_join(M.Point,
by = c("Site_N" = "Macaca_Site",
"Point" = "樣點代號"),
suffix = c(".ori", "")) %>%
st_as_sf(., coords = c("TWD97_X.ori", "TWD97_Y.ori"), crs = 3826,
remove = F,
na.fail = TRUE)%>%
View
DF %>%
add_column(analysis = "Y", .before = "Office") %>%
group_by( Site_N, Survey) %>%
arrange(Date, , .by_group = T) %>%
mutate(time_2=  c(Date[2: n()], NA))%>%
mutate(time_diff = difftime(time_2, Date, units='mins') %>%
as.numeric())  %>%
select(-time_2) %>%
mutate(day_diff = difftime(Date[n()], Date[1], units='days') %>%
as.numeric() %>% round(.,0)) %>%
ungroup() %>%
left_join(M.Point,
by = c("Site_N" = "Macaca_Site",
"Point" = "樣點代號"),
suffix = c(".ori", "")) %>%
st_as_sf(., coords = c("TWD97_X.ori", "TWD97_Y.ori"), crs = 3826,
remove = F,
na.fail = TRUE) %>%
st_as_sf(., coords = c("TWD97_X", "TWD97_Y"), crs = 3826,
remove = F,
na.fail = TRUE)%>%
View
DF %>%
add_column(analysis = "Y", .before = "Office") %>%
group_by( Site_N, Survey) %>%
arrange(Date, , .by_group = T) %>%
mutate(time_2=  c(Date[2: n()], NA))%>%
mutate(time_diff = difftime(time_2, Date, units='mins') %>%
as.numeric())  %>%
select(-time_2) %>%
mutate(day_diff = difftime(Date[n()], Date[1], units='days') %>%
as.numeric() %>% round(.,0)) %>%
ungroup() %>%
left_join(M.Point,
by = c("Site_N" = "Macaca_Site",
"Point" = "樣點代號"),
suffix = c(".ori", "")) %>%
st_as_sf(., coords = c("TWD97_X.ori", "TWD97_Y.ori"), crs = 3826,
remove = F,
na.fail = TRUE) %>%
st_as_sf(., coords = c("TWD97_X", "TWD97_Y"), crs = 3826,
remove = F,
na.fail = TRUE,
sf_column_name = "PPs")%>%
View
DF %>%
add_column(analysis = "Y", .before = "Office") %>%
group_by( Site_N, Survey) %>%
arrange(Date, , .by_group = T) %>%
mutate(time_2=  c(Date[2: n()], NA))%>%
mutate(time_diff = difftime(time_2, Date, units='mins') %>%
as.numeric())  %>%
select(-time_2) %>%
mutate(day_diff = difftime(Date[n()], Date[1], units='days') %>%
as.numeric() %>% round(.,0)) %>%
ungroup() %>%
left_join(M.Point,
by = c("Site_N" = "Macaca_Site",
"Point" = "樣點代號"),
suffix = c(".ori", "")) %>%
mutate(PPs = st_as_sf(., coords = c("TWD97_X.ori", "TWD97_Y.ori"), crs = 3826,
remove = F,
na.fail = F)) %>%
View
View
DF %>%
add_column(analysis = "Y", .before = "Office") %>%
group_by( Site_N, Survey) %>%
arrange(Date, , .by_group = T) %>%
mutate(time_2=  c(Date[2: n()], NA))%>%
mutate(time_diff = difftime(time_2, Date, units='mins') %>%
as.numeric())  %>%
select(-time_2) %>%
mutate(day_diff = difftime(Date[n()], Date[1], units='days') %>%
as.numeric() %>% round(.,0)) %>%
ungroup() %>%
left_join(M.Point,
by = c("Site_N" = "Macaca_Site",
"Point" = "樣點代號"),
suffix = c(".ori", "")) %>%
st_as_sf(., coords = c("TWD97_X.ori", "TWD97_Y.ori"), crs = 3826,
remove = F,
na.fail = F) %>%
View
DF %>%
add_column(analysis = "Y", .before = "Office") %>%
group_by( Site_N, Survey) %>%
arrange(Date, , .by_group = T) %>%
mutate(time_2=  c(Date[2: n()], NA))%>%
mutate(time_diff = difftime(time_2, Date, units='mins') %>%
as.numeric())  %>%
select(-time_2) %>%
mutate(day_diff = difftime(Date[n()], Date[1], units='days') %>%
as.numeric() %>% round(.,0)) %>%
ungroup() %>%
left_join(M.Point,
by = c("Site_N" = "Macaca_Site",
"Point" = "樣點代號"),
suffix = c(".ori", "")) %>%
mutate(PPs =st_as_sf(., coords = c("TWD97_X.ori", "TWD97_Y.ori"), crs = 3826,
remove = F,
na.fail = F)$geometry) %>%
View
DF %>%
add_column(analysis = "Y", .before = "Office") %>%
group_by( Site_N, Survey) %>%
arrange(Date, , .by_group = T) %>%
mutate(time_2=  c(Date[2: n()], NA))%>%
mutate(time_diff = difftime(time_2, Date, units='mins') %>%
as.numeric())  %>%
select(-time_2) %>%
mutate(day_diff = difftime(Date[n()], Date[1], units='days') %>%
as.numeric() %>% round(.,0)) %>%
ungroup() %>%
left_join(M.Point,
by = c("Site_N" = "Macaca_Site",
"Point" = "樣點代號"),
suffix = c(".ori", "")) %>%
mutate(P.sur =st_as_sf(., coords = c("TWD97_X.ori", "TWD97_Y.ori"), crs = 3826,
remove = F,
na.fail = F)$geometry) %>%
View
DF %>%
add_column(analysis = "Y", .before = "Office") %>%
group_by( Site_N, Survey) %>%
arrange(Date, , .by_group = T) %>%
mutate(time_2=  c(Date[2: n()], NA))%>%
mutate(time_diff = difftime(time_2, Date, units='mins') %>%
as.numeric())  %>%
select(-time_2) %>%
mutate(day_diff = difftime(Date[n()], Date[1], units='days') %>%
as.numeric() %>% round(.,0)) %>%
ungroup() %>%
left_join(M.Point,
by = c("Site_N" = "Macaca_Site",
"Point" = "樣點代號"),
suffix = c(".ori", "")) %>%
mutate(P.sur =st_as_sf(., coords = c("TWD97_X.ori", "TWD97_Y.ori"), crs = 3826,
remove = F,
na.fail = F)$geometry) %>%
mutate(P.set =st_as_sf(., coords = c("TWD97_X", "TWD97_Y"), crs = 3826,
remove = F,
na.fail = F)$geometry) %>%
View
DF %>%
add_column(analysis = "Y", .before = "Office") %>%
group_by( Site_N, Survey) %>%
arrange(Date, , .by_group = T) %>%
mutate(time_2=  c(Date[2: n()], NA))%>%
mutate(time_diff = difftime(time_2, Date, units='mins') %>%
as.numeric())  %>%
select(-time_2) %>%
mutate(day_diff = difftime(Date[n()], Date[1], units='days') %>%
as.numeric() %>% round(.,0)) %>%
ungroup() %>%
left_join(M.Point,
by = c("Site_N" = "Macaca_Site",
"Point" = "樣點代號"),
suffix = c(".ori", "")) %>%
mutate(P.sur =st_as_sf(., coords = c("TWD97_X.ori", "TWD97_Y.ori"), crs = 3826,
remove = F,
na.fail = F)$geometry) %>%
mutate(P.set =st_as_sf(., coords = c("TWD97_X", "TWD97_Y"), crs = 3826,
remove = F,
na.fail = F)$geometry) %>%
mutate(ppp = st_distance(P.sur, P.set,
by_element = TRUE)%>%
as.numeric()) %>%
View
DF %>%
add_column(analysis = "Y", .before = "Office") %>%
group_by( Site_N, Survey) %>%
arrange(Date, , .by_group = T) %>%
mutate(time_2=  c(Date[2: n()], NA))%>%
mutate(time_diff = difftime(time_2, Date, units='mins') %>%
as.numeric())  %>%
select(-time_2) %>%
mutate(day_diff = difftime(Date[n()], Date[1], units='days') %>%
as.numeric() %>% round(.,0)) %>%
ungroup() %>%
left_join(M.Point,
by = c("Site_N" = "Macaca_Site",
"Point" = "樣點代號"),
suffix = c(".ori", "")) %>%
group_by() %>%
mutate(P.sur =st_as_sf(., coords = c("TWD97_X.ori", "TWD97_Y.ori"), crs = 3826,
remove = F,
na.fail = F)$geometry) %>%
mutate(P.set =st_as_sf(., coords = c("TWD97_X", "TWD97_Y"), crs = 3826,
remove = F,
na.fail = F)$geometry) %>%
mutate(ppp = st_distance(P.sur, P.set,
by_element = TRUE)%>%
as.numeric()) %>%
View
DF %>%
add_column(analysis = "Y", .before = "Office") %>%
group_by( Site_N, Survey) %>%
arrange(Date, , .by_group = T) %>%
mutate(time_2=  c(Date[2: n()], NA))%>%
mutate(time_diff = difftime(time_2, Date, units='mins') %>%
as.numeric())  %>%
select(-time_2) %>%
mutate(day_diff = difftime(Date[n()], Date[1], units='days') %>%
as.numeric() %>% round(.,0)) %>%
ungroup() %>%
left_join(M.Point,
by = c("Site_N" = "Macaca_Site",
"Point" = "樣點代號"),
suffix = c(".ori", "")) %>%
group_by(row.names(.)) %>%
mutate(P.sur =st_as_sf(., coords = c("TWD97_X.ori", "TWD97_Y.ori"), crs = 3826,
remove = F,
na.fail = F)$geometry) %>%
mutate(P.set =st_as_sf(., coords = c("TWD97_X", "TWD97_Y"), crs = 3826,
remove = F,
na.fail = F)$geometry) %>%
mutate(ppp = st_distance(P.sur, P.set,
by_element = TRUE)%>%
as.numeric()) %>%
View
DF %>%
add_column(analysis = "Y", .before = "Office") %>%
group_by( Site_N, Survey) %>%
arrange(Date, , .by_group = T) %>%
mutate(time_2=  c(Date[2: n()], NA))%>%
mutate(time_diff = difftime(time_2, Date, units='mins') %>%
as.numeric())  %>%
select(-time_2) %>%
mutate(day_diff = difftime(Date[n()], Date[1], units='days') %>%
as.numeric() %>% round(.,0)) %>%
ungroup() %>%
left_join(M.Point,
by = c("Site_N" = "Macaca_Site",
"Point" = "樣點代號"),
suffix = c(".ori", "")) %>%
group_by(row.names(.)) %>%
mutate(P.sur =st_as_sf(., coords = c("TWD97_X.ori", "TWD97_Y.ori"), crs = 3826,
remove = F,
na.fail = F)$geometry) %>%
mutate(P.set =st_as_sf(., coords = c("TWD97_X", "TWD97_Y"), crs = 3826,
remove = F,
na.fail = F)$geometry) %>%
mutate(ppp = st_distance(P.sur, P.set,
by_element = TRUE)%>%
as.numeric()) %>%
View
DF %>%
add_column(analysis = "Y", .before = "Office") %>%
group_by( Site_N, Survey) %>%
arrange(Date, , .by_group = T) %>%
mutate(time_2=  c(Date[2: n()], NA))%>%
mutate(time_diff = difftime(time_2, Date, units='mins') %>%
as.numeric())  %>%
select(-time_2) %>%
mutate(day_diff = difftime(Date[n()], Date[1], units='days') %>%
as.numeric() %>% round(.,0)) %>%
ungroup() %>%
left_join(M.Point,
by = c("Site_N" = "Macaca_Site",
"Point" = "樣點代號"),
suffix = c(".ori", "")) %>%
group_by(row.names(.)) %>%
mutate(P.sur =st_as_sf(., coords = c("TWD97_X.ori", "TWD97_Y.ori"), crs = 3826,
remove = F,
na.fail = F)$geometry) %>%
mutate(P.set =st_as_sf(., coords = c("TWD97_X", "TWD97_Y"), crs = 3826,
remove = F,
na.fail = F)$geometry) %>%
mutate(ppp = st_distance(P.sur, P.set)%>%
as.numeric()) %>%
View
DF %>%
add_column(analysis = "Y", .before = "Office") %>%
group_by( Site_N, Survey) %>%
arrange(Date, , .by_group = T) %>%
mutate(time_2=  c(Date[2: n()], NA))%>%
mutate(time_diff = difftime(time_2, Date, units='mins') %>%
as.numeric())  %>%
select(-time_2) %>%
mutate(day_diff = difftime(Date[n()], Date[1], units='days') %>%
as.numeric() %>% round(.,0)) %>%
ungroup() %>%
left_join(M.Point,
by = c("Site_N" = "Macaca_Site",
"Point" = "樣點代號"),
suffix = c(".ori", "")) %>%
group_by(row.names(.)) %>%
mutate(P.sur =st_as_sf(., coords = c("TWD97_X.ori", "TWD97_Y.ori"), crs = 3826,
remove = F,
na.fail = F)$geometry) %>%
mutate(P.set =st_as_sf(., coords = c("TWD97_X", "TWD97_Y"), crs = 3826,
remove = F,
na.fail = F)$geometry) %>%
mutate(ppp = st_distance(P.sur, P.set,
by_element = TRUE)%>%
as.numeric()) %>%
View
DF %>%
add_column(analysis = "Y", .before = "Office") %>%
group_by( Site_N, Survey) %>%
arrange(Date, , .by_group = T) %>%
mutate(time_2=  c(Date[2: n()], NA))%>%
mutate(time_diff = difftime(time_2, Date, units='mins') %>%
as.numeric())  %>%
select(-time_2) %>%
mutate(day_diff = difftime(Date[n()], Date[1], units='days') %>%
as.numeric() %>% round(.,0)) %>%
ungroup() %>%
left_join(M.Point,
by = c("Site_N" = "Macaca_Site",
"Point" = "樣點代號"),
suffix = c(".ori", "")) %>%
filter(is.na(TWD97_X)| is.na(TWD97_Y)) %>%
group_by(row.names(.)) %>%
mutate(P.sur =st_as_sf(., coords = c("TWD97_X.ori", "TWD97_Y.ori"), crs = 3826,
remove = F)$geometry) %>%
mutate(P.set =st_as_sf(., coords = c("TWD97_X", "TWD97_Y"), crs = 3826,
remove = F)$geometry) %>%
mutate(ppp = st_distance(P.sur, P.set,
by_element = TRUE)%>%
as.numeric()) %>%
View
DF %>%
add_column(analysis = "Y", .before = "Office") %>%
group_by( Site_N, Survey) %>%
arrange(Date, , .by_group = T) %>%
mutate(time_2=  c(Date[2: n()], NA))%>%
mutate(time_diff = difftime(time_2, Date, units='mins') %>%
as.numeric())  %>%
select(-time_2) %>%
mutate(day_diff = difftime(Date[n()], Date[1], units='days') %>%
as.numeric() %>% round(.,0)) %>%
ungroup() %>%
left_join(M.Point,
by = c("Site_N" = "Macaca_Site",
"Point" = "樣點代號"),
suffix = c(".ori", "")) %>%
filter(is.na(TWD97_X)| is.na(TWD97_Y)) %>%
group_by(row.names(.)) %>%
mutate(point_diff = ddd(TWD97_X.ori, TWD97_Y.ori, TWD97_X, TWD97_Y) ) %>%
View
DF %>%
add_column(analysis = "Y", .before = "Office") %>%
group_by( Site_N, Survey) %>%
arrange(Date, , .by_group = T) %>%
mutate(time_2=  c(Date[2: n()], NA))%>%
mutate(time_diff = difftime(time_2, Date, units='mins') %>%
as.numeric())  %>%
select(-time_2) %>%
mutate(day_diff = difftime(Date[n()], Date[1], units='days') %>%
as.numeric() %>% round(.,0)) %>%
ungroup() %>%
left_join(M.Point,
by = c("Site_N" = "Macaca_Site",
"Point" = "樣點代號"),
suffix = c(".ori", "")) %>%
filter(!(is.na(TWD97_X)| is.na(TWD97_Y))) %>%
group_by(row.names(.)) %>%
mutate(point_diff = ddd(TWD97_X.ori, TWD97_Y.ori, TWD97_X, TWD97_Y) ) %>%
View
st_as_sf(c(DF$TWD97_X[1], DF$TWD97_Y[1]), crs = 3826)
st_as_sf(c(as.numeric(DF$TWD97_X[1]), as.numeric(DF$TWD97_Y[1])), crs = 3826)
as.numeric(DF$TWD97_X[1])
as.numeric(DF$TWD97_Y[1])
st_as_sf(c(271704,2683197), crs = 3826)
st_as_sf(c(271704,2683197), coords = c("X", "Y"), crs = 3826)
P.sur <- #調查位置
data.frame(X = as.numeric(DF$TWD97_X.ori[1]),Y = as.numeric(DF$TWD97_Y.ori[1])) %>%
st_as_sf(., coords = c("X", "Y"), crs = 3826)
data.frame(X = as.numeric(DF$TWD97_X.ori[1]),Y = as.numeric(DF$TWD97_Y.ori[1]))
DF$TWD97_X.ori[1]
data.frame(X = as.numeric(DF.2$TWD97_X.ori[1]),Y = as.numeric(DF.2$TWD97_Y.ori[1])) %>%
st_as_sf(., coords = c("X", "Y"), crs = 3826)
P.sur <- #調查位置
data.frame(X = as.numeric(DF.2$TWD97_X.ori[1]),Y = as.numeric(DF.2$TWD97_Y.ori[1])) %>%
st_as_sf(., coords = c("X", "Y"), crs = 3826)
P.set <- #表定位置
data.frame(X = as.numeric(DF$TWD97_X[1]),Y = as.numeric(DF$TWD97_Y[1])) %>%
st_as_sf(., coords = c("X", "Y"), crs = 3826)
st_distance(P.sur, P.set,
by_element = TRUE) %>%
as.numeric()
st_distance(P.sur, P.set,
by_element = TRUE)
DF.2 <-
DF %>%
add_column(analysis = "Y", .before = "Office") %>%
#檢核時間
group_by(Site_N, Survey) %>%
arrange(Date, .by_group = T) %>%
mutate(time_2=  c(Date[2: n()], NA))%>%
mutate(time_diff = difftime(time_2, Date, units='mins') %>%
as.numeric())  %>%
select(-time_2) %>%
mutate(day_diff = difftime(Date[n()], Date[1], units='days') %>%
as.numeric() %>% round(.,0)) %>%
ungroup() %>%
#檢核位置
left_join(M.Point,
by = c("Site_N" = "Macaca_Site",
"Point" = "樣點代號"),
suffix = c(".ori", "")) %>%
mutate(point_diff = NA) %>%
split(. ,rownames(.)) %>%
lapply(., function(x){
if(is.na(x$TWD97_X)| is.na(x$TWD97_Y)){
x$point_diff <- NA
}else{
P.sur <- #調查位置
x %>%
mutate(X = as.numeric(TWD97_X.ori)) %>%
mutate(Y = as.numeric(TWD97_Y.ori)) %>%
st_as_sf(., coords = c("X", "Y"), crs = 3826)
P.set <- #表定位置
x %>%
mutate(X = as.numeric(TWD97_X)) %>%
mutate(Y = as.numeric(TWD97_Y)) %>%
st_as_sf(., coords = c("X", "Y"), crs = 3826)
x$point_diff <-
st_distance(P.sur, P.set,
by_element = TRUE) %>%
as.numeric()
}
x
}) %>%
bind_rows() %>%
mutate(Macaca_sur.ori = Macaca_sur) %>%
mutate(Macaca_sur = ifelse(Macaca_sur %in% "1" & !is.na(Macaca_sur), 0,
ifelse(Macaca_sur %in% "2"& !is.na(Macaca_sur) , 1, Macaca_sur))) %>%
mutate(Macaca_sur = as.numeric(Macaca_sur))
DF.3 <-
DF.2 %>%
mutate(analysis = ifelse(time_diff<6 & !is.na(time_diff),
paste0(analysis, ", 6min"), analysis)) %>%
mutate(analysis = ifelse(day_diff > 7,
paste0(analysis, ", 7day"), analysis)) %>%
mutate(analysis = ifelse(data.table::as.ITime(Date) > data.table::as.ITime("10:54"),
paste0(analysis, ", Toolate"), analysis))%>%
mutate(analysis = case_when(
point_diff > 51 | is.na(point_diff) ~ paste0(analysis, ", locate"),  # range of gps =50m
Point %in% "X" ~ paste0(analysis, ", locate"),  # range of gps =50m
str_detect(備註, "刪除") ~ paste0(analysis, ", locate"),
TRUE ~ analysis)) %>%
mutate(analysis = str_replace(analysis, "Y, ",""))
DF.3 %>%  #各林管處的各疏失情況的樣點數
filter(!is.na(Macaca_sur) ) %>%
group_by(Office) %>%
summarise(
FULL = n(),
'6min' = str_subset(analysis,"6min") %>% length,
'7day' = str_subset(analysis,"7day") %>% length,
'Toolate' = str_subset(analysis,"Toolate") %>% length,
'locate' = str_subset(analysis,"locate") %>% length,
'good' = str_subset(analysis,"Y") %>% length
)
DF.2 %>%   #林管處無疏失情形的樣點數
filter(!is.na(Macaca_sur) ) %>%
filter(analysis %in% "Y" ) %>%
group_by(Office, analysis, Survey) %>%
summarise(N = n()) %>%
reshape2::dcast( Office ~ analysis + Survey, guess.var = "N")
DF.3 %>%    #時無疏失情形下，林管處在1、2旅次的猴群、孤猴數
filter(analysis %in% "Y")  %>%
filter(!is.na(Macaca_sur) ) %>%
group_by(Office, Macaca_sur, Survey) %>%
summarise(N = n()) %>%
reshape2::dcast(Office + Survey ~ Macaca_sur, guess_value  = "N")
