mutate(Point = as.numeric(Point))%>%
bind_rows(
read_excel(
here("data/clean/for analysis Forestrydata_V1.xlsx"), sheet="Data") %>%
mutate(Macaca_sur = as.numeric(Macaca_sur))
)  %>%
mutate(Office = ordered(Office,
levels = c("羅東", "新竹", "東勢", "南投",
"嘉義", "屏東", "花蓮", "臺東"),
labels = c("Luodong", "Hsinchu", "Dougshih", "Nantou",
"Chiayi", "Pingtung", "Hualien", "Taitung"))) %>%
mutate_at(c("Year", "Survey","Point","Month",
"Day", "Macaca_sur", "Distance"), as.numeric) %>%
mutate(TypeName.1 = case_when(
TypeName.1 %in% "闊葉林" ~ "broad_leaved",
TypeName.1 %in% "針葉林" ~ "coniferous",
TypeName.1 %in% "竹林" ~ "Bamboo",
TypeName.1 %in% "混淆林" ~ "mixed",
TypeName.1 %in% "非森林" ~ "Not forest"
)) %>%
filter(analysis %in% "Y")
M.data <- M.data %>%
mutate( Year.re = Year - min(Year) + 1)
df <-
M.data
allFit(glmer(Macaca_sur ~ TypeName.1  + Year.re + Altitude + julian.D + Office +  (1|Site_N) + (Year.re|Site_N),
family = binomial, data = df))   #嘗試使用一系列優化程序重新擬合glmer模型
library(tidyverse)
M.data <- read_excel("./data/clean/for analysis Forestrydata_2021_V1.xlsx",
sheet="Data")  %>%
mutate(Point = as.character(Point)) %>%
bind_rows(
read_excel("./data/clean/for analysis Forestrydata_2020_V2.xlsx",
sheet="Data") %>%
mutate(Point = as.character(Point))%>%
mutate(Macaca_sur = as.numeric(Macaca_sur))
)  %>%
mutate(Office = ordered(Office,
levels = c("羅東", "新竹", "東勢", "南投",
"嘉義", "屏東", "花蓮", "臺東"),
labels = c("Luodong", "Hsinchu", "Dougshih", "Nantou",
"Chiayi", "Pingtung", "Hualien", "Taitung"))) %>%
mutate_at(c("Year", "Survey","Month",
"Day", "Macaca_sur", "Distance"), as.numeric) %>%
mutate(TypeName.1 = case_when(
TypeName.1 %in% "闊葉林" ~ "broad_leaved",
TypeName.1 %in% "針葉林" ~ "coniferous",
TypeName.1 %in% "竹林" ~ "Bamboo",
TypeName.1 %in% "混淆林" ~ "mixed",
TypeName.1 %in% "非森林" ~ "Not forest"
)) %>%
filter(analysis %in% "Y")
# data analysis
library(tidyverse)
library(lme4)
library(car)
library(multcomp)
library(readxl)
library(MuMIn)
#------------------------------------------------
#Original data----
M.data <- read_excel("./data/clean/for analysis Forestrydata_2021_V1.xlsx",
sheet="Data")  %>%
mutate(Point = as.character(Point)) %>%
bind_rows(
read_excel("./data/clean/for analysis Forestrydata_2020_V2.xlsx",
sheet="Data") %>%
mutate(Point = as.character(Point))%>%
mutate(Macaca_sur = as.numeric(Macaca_sur))
)  %>%
mutate(Office = ordered(Office,
levels = c("羅東", "新竹", "東勢", "南投",
"嘉義", "屏東", "花蓮", "臺東"),
labels = c("Luodong", "Hsinchu", "Dougshih", "Nantou",
"Chiayi", "Pingtung", "Hualien", "Taitung"))) %>%
mutate_at(c("Year", "Survey","Month",
"Day", "Macaca_sur", "Distance"), as.numeric) %>%
mutate(TypeName.1 = case_when(
TypeName.1 %in% "闊葉林" ~ "broad_leaved",
TypeName.1 %in% "針葉林" ~ "coniferous",
TypeName.1 %in% "竹林" ~ "Bamboo",
TypeName.1 %in% "混淆林" ~ "mixed",
TypeName.1 %in% "非森林" ~ "Not forest"
)) %>%
filter(analysis %in% "Y")
M.data <- M.data %>%
mutate( Year.re = Year - min(Year) + 1)
#==============================================
df <-
M.data
allFit(glmer(Macaca_sur ~ TypeName.1  + Year.re + Altitude + julian.D + Office +  (1|Site_N),
family = binomial, data = df))   #嘗試使用一系列優化程序重新擬合glmer模型
df$Altitude.1 <-  scale(df$Altitude,scale =T)
df$julian.D.1 <-  scale(df$julian.D,scale =T)
m1 <- glmer(Macaca_sur ~  TypeName.1 + Year.re + Altitude.1 + julian.D.1 + Office  + (1|Site_N),
family = binomial, data = df,
control = glmerControl(optimizer = "bobyqa"))
Anova(m1)
#AICc==============================================
options(na.action = "na.fail")
d1<- dredge(m1,  trace = T)
d1
d1
summary(model.avg(d1))
summary(model.avg(d1, subset = delta < 2))
importance(d1)
summary(glht(m1, linfct = mcp(Office = "Tukey")))
summary(glht(m1, linfct = c("Year.re = 0",
"Altitude.1 = 0",
"julian.D.1 = 0")))
par(mai=c(1,1,1.5,0.2))
glht(m1, linfct = mcp(Office = "Tukey")) %>% cld()  %>% plot
M.data %>%
group_by(Year, Survey) %>%
summarise(
N = n(),
m = Macaca_sur %>% as.numeric() %>% sum,
E = m/N
) %>%
ggplot(., aes(x = factor(Year), y = E)) +
geom_boxplot()+
scale_y_continuous(limits =  c(0, 0.1))+
labs(x = "Year",
y = "Encounter rate (troop/point)")+
theme_classic()
M.data %>%
group_by(Year, Survey) %>%
summarise(
N = n(),
m = Macaca_sur %>% as.numeric() %>% sum,
E = m/N
) %>%
ggplot(., aes(x = factor(Year), y = E)) +
geom_boxplot()+
scale_y_continuous(limits =  c(0, 0.1),
breaks = seq(0,0.1,0.02))+
labs(x = "Year",
y = "Encounter rate (troop/point)")+
theme_classic()
M.data <- read_excel("./data/clean/for analysis Forestrydata_2021_V1.xlsx",
sheet="Data")  %>%
bind_rows(
read_excel("./data/clean/for analysis Forestrydata_2020_V2.xlsx",
sheet="Data")
)  %>%
mutate(Office = ordered(Office,
levels = c("羅東", "新竹", "東勢", "南投",
"嘉義", "屏東", "花蓮", "臺東"),
labels = c("Luodong", "Hsinchu", "Dougshih", "Nantou",
"Chiayi", "Pingtung", "Hualien", "Taitung"))) %>%
mutate_at(c("Year", "Survey","Month",
"Day", "Macaca_sur", "Distance"), as.numeric) %>%
mutate(TypeName.1 = case_when(
TypeName.1 %in% "闊葉林" ~ "broad_leaved",
TypeName.1 %in% "針葉林" ~ "coniferous",
TypeName.1 %in% "竹林" ~ "Bamboo",
TypeName.1 %in% "混淆林" ~ "mixed",
TypeName.1 %in% "非森林" ~ "Not forest"
)) %>%
filter(analysis %in% "Y")
list.files("./data/clean/for analysis/")
list.files("data/clean/for analysis/")
list.files("./data/clean/Forestry/for analysis/")
list.files("./data/clean/Forestry/for analysis/")
list.files("./data/clean/Forestry/for analysis/", full.names = T)
list.files("./data/clean/Forestry/for analysis/", full.names = T) %>%
lapply(., read_excel,
sheet="Data")
M.data <-
list.files("./data/clean/Forestry/for analysis/", full.names = T) %>%
lapply(., read_excel, sheet="Data") %>%
bind_rows() %>%
mutate(Office = ordered(Office,
levels = c("羅東", "新竹", "東勢", "南投",
"嘉義", "屏東", "花蓮", "臺東"),
labels = c("Luodong", "Hsinchu", "Dougshih", "Nantou",
"Chiayi", "Pingtung", "Hualien", "Taitung"))) %>%
mutate_at(c("Year", "Survey","Month",
"Day", "Macaca_sur", "Distance"), as.numeric) %>%
mutate(TypeName.1 = case_when(
TypeName.1 %in% "闊葉林" ~ "broad_leaved",
TypeName.1 %in% "針葉林" ~ "coniferous",
TypeName.1 %in% "竹林" ~ "Bamboo",
TypeName.1 %in% "混淆林" ~ "mixed",
TypeName.1 %in% "非森林" ~ "Not forest"
)) %>%
filter(analysis %in% "Y")
M.data <-
list.files("./data/clean/Forestry/for analysis/", full.names = T) %>%
lapply(., read_excel, sheet="Data") %>%
bind_rows() %>%
mutate(Office =
ordered(Office,
levels = c("羅東", "新竹", "東勢", "南投",
"嘉義", "屏東", "花蓮", "臺東"),
labels = c("Luodong", "Hsinchu", "Dougshih", "Nantou",
"Chiayi", "Pingtung", "Hualien", "Taitung")
)
) %>%
mutate_at(c("Year", "Survey","Month",
"Day", "Macaca_sur", "Distance"), as.numeric) %>%
mutate(TypeName.1 = case_when(
TypeName.1 %in% "闊葉林" ~ "broad_leaved",
TypeName.1 %in% "針葉林" ~ "coniferous",
TypeName.1 %in% "竹林" ~ "Bamboo",
TypeName.1 %in% "混淆林" ~ "mixed",
TypeName.1 %in% "非森林" ~ "Not forest"
)) %>%
filter(analysis %in% "Y")
knitr::opts_chunk$set(echo = TRUE)
library(here)
here("./data/clean/Forestry/for analysis/") %>%
list.files(., full.names = T) %>%
str_detect("2021")
here("./data/clean/Forestry/for analysis/") %>%
list.files(., full.names = T) %>%
str_subset("2021")
here("./data/clean/Forestry/for analysis/") %>%
list.files(., full.names = T) %>%
str_subset(paste0(2020:2021))
Anova(m1)
d1
importance(d1)
Anova(m1.1)
m1.1 <- glmer(Macaca_sur ~   Year.re +  julian.D.1 + Office  + (1|Site_N),
family = binomial, data = df,
control = glmerControl(optimizer = "bobyqa"))
Anova(m1.1)
Anova(m1.1)
summary(glht(m1, linfct = mcp(Office = "Tukey")))
emmeans(m1, "interaction", type = "response")
summary(glht(m1, linfct = mcp(Office = "Tukey", test = adjusted("free"))))
summary(glht(m1, linfct = mcp(Office = "Tukey"), test = adjusted("free")))
install.packages("emmeans")
emmeans::emmeans(m1, "interaction", type = "response")
emmeans(m1, "interaction")
emmeans::emmeans(m1, "interaction")
summary(glht(m1, linfct = mcp(Office = "Tukey")))
summary(glht(m1.1, linfct = mcp(Office = "Tukey")))
m1.2 <- glmer(Macaca_sur ~   Year.re +   Office  + (1|Site_N),
family = binomial, data = df,
control = glmerControl(optimizer = "bobyqa"))
summary(glht(m1.2, linfct = mcp(Office = "Tukey")))
summary(glht(m1, linfct = mcp(Office = "Tukey")))
summary(glht(m1, linfct = c("Year.re = 0",
"Altitude.1 = 0",
"julian.D.1 = 0")))
summary(glht(m1, linfct = mcp(Office = "Tukey")))
summary(as.glht(pairs(m1)), test=adjusted("free"))
summary(glht(pairs(m1)), test=adjusted("free"))
summary(glht(m1, linfct = mcp(Office = "Tukey", test=adjusted("free"))))
glht(m1, linfct = mcp(Office = "Tukey", test=adjusted("free")))
glht(m1, linfct = mcp(Office = "Tukey"))
glht(m1, linfct = mcp(Office = "Tukey")) %>% summary
glht(m1, linfct = mcp(Office = "Tukey")) %>% cld()
M.data %>%
group_by(Year, Survey) %>%
summarise(
N = n(),
m = Macaca_sur %>% as.numeric() %>% sum,
E = m/N
) %>%
ggplot(., aes(x = factor(Office), y = E)) +
geom_boxplot()+
scale_y_continuous(limits =  c(0, 0.1),
breaks = seq(0,0.1,0.02))+
labs(x = "Year",
y = "Encounter rate (troop/point)")+
theme_classic()
M.data %>%
group_by(Year, Survey) %>%
summarise(
N = n(),
m = Macaca_sur %>% as.numeric() %>% sum,
E = m/N
)
M.data %>%
group_by(Office, Survey) %>%
summarise(
N = n(),
m = Macaca_sur %>% as.numeric() %>% sum,
E = m/N
) %>%
ggplot(., aes(x = factor(Office), y = E)) +
geom_boxplot()+
scale_y_continuous(limits =  c(0, 0.1),
breaks = seq(0,0.1,0.02))+
labs(x = "Year",
y = "Encounter rate (troop/point)")+
theme_classic()
M.data %>%
group_by(Office, Survey) %>%
summarise(
N = n(),
m = Macaca_sur %>% as.numeric() %>% sum,
E = m/N
) %>%
ggplot(., aes(x = factor(Office), y = E)) +
geom_boxplot()+
scale_y_continuous(limits =  c(0, 1),
breaks = seq(0,1,0.02))+
labs(x = "Year",
y = "Encounter rate (troop/point)")+
theme_classic()
M.data %>%
group_by(Office, Survey) %>%
summarise(
N = n(),
m = Macaca_sur %>% as.numeric() %>% sum,
E = m/N
) %>%
ggplot(., aes(x = factor(Office), y = E)) +
geom_boxplot()+
scale_y_continuous(limits =  c(0, 0.2),
breaks = seq(0,0.2,0.02))+
labs(x = "Year",
y = "Encounter rate (troop/point)")+
theme_classic()
M.data %>%
group_by(Office, Survey) %>%
summarise(
N = n(),
m = Macaca_sur %>% as.numeric() %>% sum,
E = m/N
) %>%
ggplot(., aes(x = factor(Office), y = E)) +
geom_boxplot()+
scale_y_continuous(limits =  c(0, 1.6),
breaks = seq(0,1.6,0.02))+
labs(x = "Year",
y = "Encounter rate (troop/point)")+
theme_classic()
M.data %>%
group_by(Office, Survey) %>%
summarise(
N = n(),
m = Macaca_sur %>% as.numeric() %>% sum,
E = m/N
) %>%
ggplot(., aes(x = factor(Office), y = E)) +
geom_boxplot()+
scale_y_continuous(limits =  c(0, 0.16),
breaks = seq(0,0.16,0.02))+
labs(x = "Year",
y = "Encounter rate (troop/point)")+
theme_classic()
M.data %>%
group_by(Office, Survey) %>%
summarise(
N = n(),
m = Macaca_sur %>% as.numeric() %>% sum,
E = m/N
) %>%
ggplot(., aes(x = factor(Office), y = E)) +
geom_boxplot()+
scale_y_continuous(limits =  c(0, 0.14),
breaks = seq(0,0.14,0.02))+
labs(x = "Year",
y = "Encounter rate (troop/point)")+
theme_classic()
M.data %>%
group_by(Office, Survey) %>%
summarise(
N = n(),
m = Macaca_sur %>% as.numeric() %>% sum,
E = m/N
) %>%
ggplot(., aes(x = factor(Office), y = E)) +
geom_boxplot()+
scale_y_continuous(limits =  c(0, 0.12),
breaks = seq(0,0.12,0.02))+
labs(x = "Year",
y = "Encounter rate (troop/point)")+
theme_classic()
M.data %>%
group_by(Year, Survey) %>%
summarise(
N = n(),
m = Macaca_sur %>% as.numeric() %>% sum,
E = m/N
) %>%
ggplot(., aes(x = factor(Year), y = E)) +
geom_boxplot()+
scale_y_continuous(limits =  c(0, 0.1),
breaks = seq(0,0.1,0.02))+
labs(x = "Year",
y = "Encounter rate (troop/point)")+
theme_classic()
glht(m1, linfct = mcp(Office = "Tukey"))
glht(m1, linfct = mcp(Office = "Tukey")) %>% emmeans::emmeans()
glht(m1) %>% emmeans::emmeans()
as.glht(m1) %>% emmeans::emmeans()
emmeans::emmeans(m1)
emmeans::emmeans(m1, by = "Office")
emmeans::emmeans(m1, specs = "Office")
emmeans::emmeans(m1, specs = "Office", adjust = "free")
warp.lm <- lm(breaks ~ wool * tension, data = warpbreaks)
emmeans (warp.lm,  ~ wool | tension)
library(emmeans)
warp.lm <- lm(breaks ~ wool * tension, data = warpbreaks)
emmeans (warp.lm,  ~ wool | tension)
emmeans (warp.lm, ~ tension | wool, adjust = "sidak")
emmeans::emmeans(m1, "Office", adjust = "free")
emmeans::emmeans(m1, ~Office, adjust = "free")
as.glht(m1) %>% emmeans::emmeans()
glht(m1, linfct = mcp(Office = "Tukey")) %>% emmeans::emmeans()
as.glht(m1, linfct = mcp(Office = "Tukey")) %>% emmeans::emmeans()
summary(as.glht(pairs(warp.emm), by = NULL))
warp.lm <- lm(breaks ~ wool*tension, data = warpbreaks)
warp.emm <- emmeans(warp.lm, ~ tension | wool)
summary(as.glht(pairs(warp.emm)))
summary(as.glht(pairs(emmeans(m1))))
summary(as.glht(pairs(emmeans(m1, ~Office))))
summary(as.glht(pairs(emmeans(m1, ~Office, "free"))))
summary(as.glht(pairs(emmeans(m1, ~Office))))
summary(as.glht(pairs(emmeans(m1, ~Yea.re))))
summary(as.glht(pairs(emmeans(m1, ~Year.re))))
summary(as.glht(pairs(emmeans(m1, ~Office))), test=adjusted("free"))
summary(as.glht(pairs(emmeans(m1, ~Office))), test=adjusted("free")) %>% plot
fib.lm = lm(strength ~ machine * sqrt(diameter), data = fiber)
fib.rg = ref_grid(fib.lm, at = list(diameter = c(3.5, 4, 4.5, 5, 5.5, 6)^2))
emmip(fib.rg, machine ~ diameter)   # curves (because diameter is numeric)
noise.lm = lm(noise ~ size * type * side, data = auto.noise)
# Separate interaction plots of size by type, for each side
emmip(noise.lm, type ~ size | side)
emmip(noise.lm, type ~ side * size, CIs = TRUE,
linearg = list(linetype = "dashed"), CIarg = list(lwd = 1, alpha = 1))
emmip(m1, Macaca_sur ~ Office, CIs = TRUE,
linearg = list(linetype = "dashed"), CIarg = list(lwd = 1, alpha = 1))
Office
emmip(noise.lm, type * side ~ size)
emmip(m1, Office ~ Year.re)
emmip(m1, Office ~ TypeName.1)
emmip(m1, Office ~ Year.re)
emmip(m1, TypeName.1 ~ Year.re)
emmip(m1, TypeName.1 ~ Office)
M.data %>%
group_by(TypeName.1, Survey) %>%
summarise(
N = n(),
m = Macaca_sur %>% as.numeric() %>% sum,
E = m/N
) %>%
ggplot(., aes(x = factor(TypeName.1), y = E)) +
geom_boxplot()+
scale_y_continuous(limits =  c(0, 0.12),
breaks = seq(0,0.12,0.02))+
labs(x = "Year",
y = "Encounter rate (troop/point)")+
theme_classic()
M.data %>%
group_by(TypeName.1, Survey) %>%
summarise(
N = n(),
m = Macaca_sur %>% as.numeric() %>% sum,
E = m/N
) %>%
ggplot(., aes(x = factor(TypeName.1), y = E)) +
geom_boxplot()+
#  scale_y_continuous(limits =  c(0, 0.12),
#                    breaks = seq(0,0.12,0.02))+
labs(x = "Year",
y = "Encounter rate (troop/point)")+
theme_classic()
M.data %>%
group_by(TypeName.1, Survey) %>%
summarise(
N = n(),
m = Macaca_sur %>% as.numeric() %>% sum,
E = m/N
) %>%
ggplot(., aes(x = factor(TypeName.1), y = E)) +
geom_boxplot()+
scale_y_continuous(limits =  c(0, 0.06),
breaks = seq(0,0.06,0.02))+
labs(x = "Year",
y = "Encounter rate (troop/point)")+
theme_classic()
aic(m1)
summary(m1)
d1
Anova(m1)
summary(m1)
df %>% filter(Macaca_sur==1) %>% dim()
Anova(m1.1)
summary(m1.1)
summary(as.glht(pairs(emmeans(m1.1, ~Office))), test=adjusted("free"))
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
library(writexl)
library(sf)
library(here)
library(flextable)
library(ftExtra)
M.data <-
here("./data/clean/Forestry/for analysis/") %>%
list.files(., full.names = T) %>%
str_subset(paste0(2021)) %>% #如果只要2020~2021年，就寫2020:2021
lapply(., read_excel, sheet="Data") %>%
bind_rows() %>%
mutate(Office = ordered(Office,
c("羅東", "新竹", "東勢", "南投",
"嘉義", "屏東", "花蓮", "臺東"))) %>%
mutate(TypeName.1 = ordered(TypeName.1,
c("闊葉林", "針葉林", "竹林",
"混淆林", "非森林"))) %>%
mutate_at(c("Year", "Survey","Point","Month",
"Day", "Macaca_sur", "Distance"), as.numeric)
M.data %>% filter(Macaca_sur.ori =="C") %>% dim()
View(M.data)
M.data %>% filter(Macaca_sur.ori == 2) %>% filter(Macaca_dist == "C")%>% dim()
