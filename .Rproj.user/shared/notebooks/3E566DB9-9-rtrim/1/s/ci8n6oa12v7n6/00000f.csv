"0","#Original data---- "
"0",""
"0","M.data <- read_excel(here(""./data/clean/for analysis_1521.xlsx""),"
"0","                     sheet=1) %>% setDT %>% "
"0",""
"0","  .[, Year := as.numeric(Year)] %>% "
"0","  .[, Survey := as.numeric(Survey)] %>% "
"0","  .[, Point := as.numeric(Point)] %>% "
"0","  .[, Macaca_sur := as.numeric(Macaca_sur)] %>% "
"0","  .[, Month := as.numeric(Month)] %>% "
"0","  .[, Day := as.numeric(Day)] %>% "
"0","  .[, Distance := as.numeric(Distance)] %>% "
"0","  .[, julian.D := as.numeric(julian.D)] %>% "
"0","  .[, TypeName.1 := as.factor(TypeName.1)] %>% "
"0","  .[, Site_N := as.factor(Site_N)] %>% "
"0","  .[, Region2 := as.factor(Region2)] "
"0",""
"0","#----------------------------"
"0",""
"0","county.area <- read.csv(here(""./data/clean/gis/county area-2.csv""), header = T) %>% "
"0","  setDT %>% "
"0","  setnames(.,c(""County"", ""Area"", ""perimeter"")) %>% "
"0","  .[County %in% list(""å®œè˜­ç¸£"",""åŸºéš†å¸‚"",""å°åŒ—å¸‚"",""è‡ºåŒ—å¸‚"","
"0","                     ""æ–°åŒ—å¸‚"",""å°åŒ—ç¸£"",""è‡ºåŒ—ç¸£"","
"0","                     ""æ¡ƒåœ’ç¸£"",""æ¡ƒåœ’å¸‚"",""æ–°ç«¹å¸‚"","
"0","                     ""æ–°ç«¹ç¸£"",""è‹—æ —ç¸£""), Region := ""North""] %>%"
"0","  .[County %in% list(""å°ä¸­å¸‚"",""è‡ºä¸­å¸‚"","
"0","                     ""å°ä¸­ç¸£"",""è‡ºä¸­ç¸£"","
"0","                     ""å½°åŒ–ç¸£"",""å—æŠ•ç¸£"",""å—æŠ•å¸‚"","
"0","                     ""é›²æž—ç¸£"",""å˜‰ç¾©ç¸£"",""å˜‰ç¾©å¸‚""), Region := ""Center""] %>%"
"0","  .[County %in% list(""å°å—å¸‚"",""è‡ºå—å¸‚"","
"0","                     ""å°å—ç¸£"",""è‡ºå—ç¸£"","
"0","                     ""é«˜é›„ç¸£"",""é«˜é›„å¸‚"","
"0","                     ""å±æ±ç¸£""), Region := ""South""]%>%"
"0","  .[County %in% list(""èŠ±è“®ç¸£"","
"0","                     ""å°æ±ç¸£"",""è‡ºæ±ç¸£""), Region := ""East""] %>% "
"0","  "
"0","  "
"0","  "
"0","  .[County %in% list(""å®œè˜­ç¸£"",""åŸºéš†å¸‚"",""å°åŒ—å¸‚"",""è‡ºåŒ—å¸‚"","
"0","                     ""æ–°åŒ—å¸‚"",""å°åŒ—ç¸£"",""è‡ºåŒ—ç¸£"","
"0","                     ""æ¡ƒåœ’ç¸£"",""æ¡ƒåœ’å¸‚"",""æ–°ç«¹å¸‚"","
"0","                     ""æ–°ç«¹ç¸£"",""è‹—æ —ç¸£""), Region2 := ""North""] %>% "
"0","  .[County %in% list(""å°ä¸­å¸‚"",""è‡ºä¸­å¸‚"","
"0","                     ""å°ä¸­ç¸£"",""è‡ºä¸­ç¸£"","
"0","                     ""å½°åŒ–ç¸£"",""å—æŠ•ç¸£"",""å—æŠ•å¸‚""), Region2 := ""Center""] %>% "
"0","  .[County %in% list(""é›²æž—ç¸£"",""å˜‰ç¾©ç¸£"",""å˜‰ç¾©å¸‚"","
"0","                     ""å°å—å¸‚"",""è‡ºå—å¸‚"","
"0","                     ""å°å—ç¸£"",""è‡ºå—ç¸£""), Region2 := ""Southwest""] %>%"
"0","  .[County %in% list(""é«˜é›„ç¸£"",""é«˜é›„å¸‚"","
"0","                     ""å±æ±ç¸£""), Region2 := ""South""]%>%"
"0","  .[County %in% list(""èŠ±è“®ç¸£""), Region2 := ""Hualien""] %>%"
"0","  .[County %in% list(""å°æ±ç¸£"",""è‡ºæ±ç¸£""), Region2 := ""Taitung""] %>% "
"0","  "
"0","  .[!is.na(Region2),] %>% "
"0","  .[, .(area=sum(Area)), by = list(Region2)] %>% "
"0","  .[, prob_Area:= (area/sum(area))] %>% "
"0","  .[, Region2 := as.character(Region2)]"
"0",""
"0","weight <- "
"0","  M.data %>% "
"0","  setDT  %>% "
"0","  .[, Region2 := as.character(Region2)]%>% "
"0","  .[is.na(Macaca_sur), Macaca_sur := 0] %>% "
"0","  #.[Year < 2019,] %>%"
"0","  .[!(TypeName.1 %in% ""Not forest""), ] %>% "
"0","  .[, SP := paste0(Site_N,""-"",Point)]  %>%"
"0","  .[, list(Year, SP, Survey, Region2)] %>%"
"0","  .[, .(point_n = .N), by = list(Year, SP, Region2)] %>% "
"0","  .[, SP_n := .N, by = list(Year,Region2)] %>%"
"0","  left_join(county.area)  %>% setDT %>%"
"0","  .[, weight := (prob_Area / SP_n /point_n)]  "
"1","[38;5;255mJoining, by = ""Region2""[39m
"
"0","df <- "
"0","  M.data %>% "
"0","  setDT %>% "
"0","  .[is.na(Macaca_sur), Macaca_sur := 0] %>% "
"0","  #.[Year < 2019,] %>%"
"0","  .[!(TypeName.1 %in% ""Not forest""), ] %>% "
"0","  .[, SP := paste0(Site_N,""-"",Point)] %>% "
"0","  .[, .(number = sum(Macaca_sur)), by = list(Year, SP, Region2, Altitude)] %>% "
"0","  .[, N := sum(number), by = list(SP, Region2)] %>% "
"0","  left_join(weight[, c(1:2, 8)])  %>% setDT %>%"
"0","  .[!(N %in% 0),] %>% "
"0","  .[, N := NULL] %>% "
"0","  .[, Altitude_f := cut(Altitude,"
"0","                        breaks = c(0,1000,2500,4000),"
"0","                        labels = c(""A"",""B"",""C""),"
"0","                        include.lowest = T)] %>%"
"0","  .[, Altitude_f := factor(Altitude_f)] %>%"
"0","  .[, Region2 := factor(Region2)] %>% "
"0","  .[,Altitude := NULL] %>% "
"0","  setDF"
"1","[38;5;255mJoining, by = c(""Year"", ""SP"")[39m
"
