"0","M.data %>% "
"0","  filter(! is.na(Macaca_sur)) %>% "
"0","  group_by(Office, Year) %>% "
"0","  summarise("
"0","    Point_n = n(),"
"0","    Good_n = str_subset(analysis, ""^Y"") %>%length"
"0","  ) %>% "
"0","  ungroup() %>%"
"0","  "
"0",""
"0","  "
"0","  bind_rows("
"0","    M.data %>% "
"0",""
"0","      filter(! is.na(Macaca_sur))%>% "
"0","      group_by(Year) %>% "
"0","      summarise("
"0","        Point_n = n(),"
"0","        Good_n = str_subset(analysis, ""^Y"") %>%length"
"0","        ) %>% "
"0","      mutate(Office = ""Total"") %>% "
"0","      ungroup() "
"0","    ) %>% "
"0","  "
"0","  mutate(prob = (100 * Good_n/Point_n) %>%  round(1)) %>%"
"0","  reshape2::melt(id = 1:2) %>% "
"0","  reshape2::dcast(Office ~ Year + variable, value.var = ""value"") %>%"
"0","  mutate(level2 = ifelse(Office %in% ""Total"", 2, 1)) %>% "
"0",""
"0","  arrange(level2, desc(`2021_prob`) )%>% "
"0","  "
"0","  mutate(prob_diff = paste0(`2021_prob`, ""("","
"0","                            round( `2021_prob`-`2020_prob`, 1), "")"")"
"0","         ) %>% "
"0","  "
"0","  select(-`level2`, -starts_with(""2020""), -`2021_prob`) %>% "
"0","  flextable(.)  %>% "
"0","  "
"0","  set_header_labels("
"0","    ""Office""=""林管處"","
"0","    ""2021_Point_n""=""樣點"","
"0","    ""2021_Good_n"" = ""無疏失的樣點"","
"0","    ""prob_diff"" = ""正確率%"") %>% "
"0","  add_header_row(., "
"0","                 values = c("" "", ""2021""),"
"0","                 colwidths = c(1,3)) %>% "
"0","  "
"0",""
"0","  theme_booktabs(.)%>% "
"0","  align(.,"
"0","        align = ""center"", part = ""all"")"
