"0","#Original data---- "
"0",""
"0","M.data <- read_excel(here(""./data/clean/for analysis_1523.xlsx""),"
"0","                     sheet=1) %>% setDT %>% "
"0",""
"0","  .[, Year := as.numeric(Year)] %>% "
"0","  .[, Survey := as.numeric(Survey)] %>% "
"0","  .[, Point := as.numeric(Point)] %>% "
"0","  .[, Macaca_sur := as.numeric(Macaca_sur)] %>% "
"0","  .[, Month := as.numeric(Month)] %>% "
"0","  .[, Day := as.numeric(Day)] %>% "
"0","  .[, Distance := as.numeric(Distance)] %>% "
"0","  .[, julian.D := as.numeric(julian.D)] %>% "
"0","  .[, TypeName.1 := as.factor(TypeName.1)] %>% "
"0","  .[, Site_N := as.factor(Site_N)] %>% "
"0","  .[, Region2 := as.factor(Region2)] "
"0",""
"0","#----------------------------"
"0",""
"0","county.area <- "
"0","  read.csv(here(""./data/clean/gis/county area-3.csv""), header = T) %>%  #因為編碼問題所以從county area-2換成county area-3"
"0","  setDT %>% "
"0","  setnames(.,c(""County"", ""Area"", ""perimeter"")) %>% "
"0","  .[County %in% list(""宜蘭縣"",""基隆市"",""台北市"",""臺北市"","
"0","                     ""新北市"",""台北縣"",""臺北縣"","
"0","                     ""桃園縣"",""桃園市"",""新竹市"","
"0","                     ""新竹縣"",""苗栗縣""), Region := ""North""] %>%"
"0","  .[County %in% list(""台中市"",""臺中市"","
"0","                     ""台中縣"",""臺中縣"","
"0","                     ""彰化縣"",""南投縣"",""南投市"","
"0","                     ""雲林縣"",""嘉義縣"",""嘉義市""), Region := ""Center""] %>%"
"0","  .[County %in% list(""台南市"",""臺南市"","
"0","                     ""台南縣"",""臺南縣"","
"0","                     ""高雄縣"",""高雄市"","
"0","                     ""屏東縣""), Region := ""South""]%>%"
"0","  .[County %in% list(""花蓮縣"","
"0","                     ""台東縣"",""臺東縣""), Region := ""East""] %>% "
"0","  "
"0","  "
"0","  "
"0","  .[County %in% list(""宜蘭縣"",""基隆市"",""台北市"",""臺北市"","
"0","                     ""新北市"",""台北縣"",""臺北縣"","
"0","                     ""桃園縣"",""桃園市"",""新竹市"","
"0","                     ""新竹縣"",""苗栗縣""), Region2 := ""North""] %>% "
"0","  .[County %in% list(""台中市"",""臺中市"","
"0","                     ""台中縣"",""臺中縣"","
"0","                     ""彰化縣"",""南投縣"",""南投市""), Region2 := ""Center""] %>% "
"0","  .[County %in% list(""雲林縣"",""嘉義縣"",""嘉義市"","
"0","                     ""台南市"",""臺南市"","
"0","                     ""台南縣"",""臺南縣""), Region2 := ""Southwest""] %>%"
"0","  .[County %in% list(""高雄縣"",""高雄市"","
"0","                     ""屏東縣""), Region2 := ""South""]%>%"
"0","  .[County %in% list(""花蓮縣""), Region2 := ""Hualien""] %>%"
"0","  .[County %in% list(""台東縣"",""臺東縣""), Region2 := ""Taitung""] %>% "
"0","  "
"0","  .[!is.na(Region2),] %>% "
"0","  .[, .(area=sum(Area)), by = list(Region2)] %>% "
"0","  .[, prob_Area:= (area/sum(area))] %>% "
"0","  .[, Region2 := as.character(Region2)]"
"0",""
"0","weight <- "
"0","  M.data %>% "
"0","  setDT  %>% "
"0","  .[, Region2 := as.character(Region2)]%>% "
"0","  .[is.na(Macaca_sur), Macaca_sur := 0] %>% "
"0","  #.[Year < 2019,] %>%"
"0","  .[!(TypeName.1 %in% ""Not forest""), ] %>% "
"0","  .[, SP := paste0(Site_N,""-"",Point)]  %>%"
"0","  .[, list(Year, SP, Survey, Region2)] %>%"
"0","  .[, .(point_n = .N), by = list(Year, SP, Region2)] %>% "
"0","  .[, SP_n := .N, by = list(Year,Region2)] %>%"
"0","  left_join(county.area)  %>% setDT %>%"
"0","  .[, weight := (prob_Area / SP_n /point_n)]  "
"2","Joining with `by = join_by(Region2)`"
"0","df <- "
"0","  M.data %>% "
"0","  setDT %>% "
"0","  .[is.na(Macaca_sur), Macaca_sur := 0] %>% "
"0","  .[Year < 2020 & Year < 2024,] %>%"
"0","  .[!(TypeName.1 %in% ""Not forest""), ] %>% "
"0","  .[, SP := paste0(Site_N,""-"",Point)] %>% "
"0","  .[, .(number = sum(Macaca_sur)), by = list(Year, SP, Region2, Altitude)] %>% "
"0","  .[, N := sum(number), by = list(SP, Region2)] %>% "
"0","  left_join(weight[, c(1:2, 8)])  %>% setDT %>%"
"0","  .[!(N %in% 0),] %>% "
"0","  .[, N := NULL] %>% "
"0","  .[, Altitude_f := cut(Altitude,"
"0","                        breaks = c(0,1000,2500,4000),"
"0","                        labels = c(""A"",""B"",""C""),"
"0","                        include.lowest = T)] %>%"
"0","  .[, Altitude_f := factor(Altitude_f)] %>%"
"0","  .[, Region2 := factor(Region2)] %>% "
"0","  .[,Altitude := NULL] %>% "
"0","  setDF "
"2","Joining with `by = join_by(Year, SP)`"
