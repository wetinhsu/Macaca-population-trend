"0","#Part 2 刪疏失的資料----------------"
"0","#(刪除不足6分鐘、 after11pm、不在檢核點上、同一旅次超過7日才完成調查)----------"
"0","#同一旅次同一樣區內超過7日才完成調查，整個旅次的資料方棄。----"
"0",""
"0"," DF.3 <- "
"0","  DF %>% "
"0","  add_column(analysis = ""Y"", .before = ""Office"") %>% "
"0","  # mutate(TWD97_X = str_replace_all(TWD97_X, ""999999"", NA_character_))%>% "
"0","  # mutate(TWD97_Y = str_replace_all(TWD97_Y, ""999999"", NA_character_)) %>% "
"0","  "
"0","  #檢核時間"
"0","  group_by(Site_N, Survey) %>% "
"0","  arrange(Date, .by_group = T) %>%  #group內排序"
"0","  mutate(time_2=  c(Date[2: n()], NA))%>% "
"0","  mutate(time_diff = difftime(time_2, Date, units='mins') %>% "
"0","           as.numeric())  %>% "
"0","  select(-time_2) %>% "
"0","  "
"0","  mutate(day_diff = difftime(Date[n()], Date[1], units='days') %>% "
"0","           as.numeric() %>% round(.,0)) %>%"
"0","  "
"0","  ungroup() %>% "
"0",""
"0","  #檢核位置"
"0","  left_join(list_Point,"
"0","            by = c(""Site_N"" = ""獼猴樣區編號"","
"0","                   ""Point""= ""樣點代號"" ),"
"0","            suffix = c("".ori"", """")) %>% "
"0","  "
"0","  #為了計算距離，先轉成""數字格式"""
"0","  mutate_at(c(""TWD97_X"", ""TWD97_Y"", ""TWD97_X.ori"", ""TWD97_Y.ori""), as.numeric) %>% "
"0","  "
"0",""
"0","  #計算距離"
"0","  mutate(point_diff = ifelse("
"0","    is.na(TWD97_X)| is.na(TWD97_Y), NA,"
"0","    st_distance("
"0","      st_as_sf(., coords = c(""TWD97_X.ori"", ""TWD97_Y.ori""),"
"0","               crs = 3826, remove = F, na.fail = F),#調查位置"
"0","      "
"0","      st_as_sf(., coords = c(""TWD97_X"", ""TWD97_Y""),"
"0","               crs = 3826, remove = F, na.fail = F),#表定位置"
"0","      by_element = TRUE) %>% "
"0","      as.numeric()"
"0","    )) %>% "
"0","  #再轉回""文字格式"""
"0","  mutate_at(c(""TWD97_X"", ""TWD97_Y"", ""TWD97_X.ori"", ""TWD97_Y.ori""), as.character) %>% "
"0","  "
"0","  mutate(Macaca_sur.ori = Macaca_sur) %>% "
"0","  mutate(Macaca_sur = ifelse(Macaca_sur %in% ""1"" & !is.na(Macaca_sur), 0,"
"0","                             ifelse(Macaca_sur %in% ""2""& !is.na(Macaca_sur) , 1, Macaca_sur))) %>% "
"0","  mutate(Macaca_sur = as.numeric(Macaca_sur)) %>% "
"0","  "
"0","  "
"0","  "
"0","  #判斷是否符合標準"
"0","  mutate(analysis = ifelse(time_diff<6 & !is.na(time_diff),"
"0","                           paste0(analysis, "", 6min""), analysis)) %>% "
"0","  mutate(analysis = ifelse(day_diff > 7 & !is.na(day_diff), "
"0","                           paste0(analysis, "", 7day""), analysis)) %>% "
"0","  "
"0","  mutate(analysis = ifelse(data.table::as.ITime(Date) > data.table::as.ITime(""10:54""), "
"0","                           paste0(analysis, "", Toolate""), analysis))%>% "
"0","  "
"0","  mutate(analysis = case_when("
"0","             point_diff > 51 | is.na(point_diff) ~ paste0(analysis, "", locate""),  # range of gps =50m"
"0","             Point %in% ""X"" ~ paste0(analysis, "", locate""),  # range of gps =50m"
"0","             str_detect(Note, ""刪除"") ~ paste0(analysis, "", locate""),"
"0","             TRUE ~ analysis)) %>% "
"0","  mutate(analysis = str_replace(analysis, ""Y, "",""""))"
